# AI情绪日记 - 前后端联调指南

## 🎯 联调目标

验证前端与后端API的完整对接，确保数据能够正确传输和显示。

## 🚀 环境准备

### 后端服务
1. **启动Django服务器**
   ```bash
   cd backend
   source emotion_diary_env/bin/activate
   python manage.py runserver 0.0.0.0:8000
   ```

2. **验证后端服务**
   - API文档：http://127.0.0.1:8000/api/docs/
   - 管理后台：http://127.0.0.1:8000/admin/

### 前端服务
1. **启动前端开发服务器**
   ```bash
   cd frontend
   npm run dev
   ```

2. **访问前端应用**
   - 开发地址：http://localhost:5173
   - 网络地址：http://192.168.3.115:5173

## 🔐 测试账号

已创建测试账号用于联调：
- **用户名**: testuser
- **密码**: testpass123
- **邮箱**: test@example.com

## 📊 测试数据

后端已生成以下测试数据：
- ✅ 1个测试用户
- ✅ 16个情绪标签（情绪类型、场景、触发因素）
- ✅ 7条情绪记录（覆盖最近7天）

## 🧪 联调测试步骤

### 1. 用户认证测试
- [ ] 打开前端应用
- [ ] 自动跳转到登录页面
- [ ] 使用测试账号登录
- [ ] 验证登录成功并跳转到首页

### 2. 首页数据加载测试
- [ ] 验证用户名显示正确
- [ ] 检查今日情绪概览
- [ ] 查看最近记录列表
- [ ] 确认数据统计信息

### 3. 快速记录功能测试
- [ ] 点击首页快速情绪标签
- [ ] 验证记录创建成功
- [ ] 检查页面数据实时更新

### 4. API接口测试

#### 认证接口
```bash
# 登录测试
curl -X POST -H "Content-Type: application/json" \
  http://127.0.0.1:8000/api/v1/auth/login/ \
  -d '{"username":"testuser","password":"testpass123"}'
```

#### 情绪记录接口
```bash
# 获取记录列表（需要token）
curl -H "Authorization: Token YOUR_TOKEN" \
  http://127.0.0.1:8000/api/v1/emotions/records/

# 获取今日记录
curl -H "Authorization: Token YOUR_TOKEN" \
  http://127.0.0.1:8000/api/v1/emotions/records/today/
```

## 🔧 API配置

### 基础配置
- **API基础URL**: `http://127.0.0.1:8000/api/v1`
- **认证方式**: Token认证
- **数据格式**: JSON

### 跨域配置
后端已配置CORS允许前端访问：
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173", 
    "http://192.168.3.115:5173",
]
```

## 📱 前端功能测试清单

### 首页 (index)
- [x] 用户认证检查
- [x] 今日情绪数据展示
- [x] 最近记录列表
- [x] 快速记录功能
- [x] 数据实时更新

### 登录页 (login)
- [x] 用户登录
- [x] Token保存
- [x] 错误处理
- [x] 调试信息显示

### 记录页 (record)
- [ ] 详细情绪记录
- [ ] 表单数据提交
- [ ] 场景和标签选择

### 分析页 (analysis)
- [ ] AI分析结果展示
- [ ] 情绪洞察显示
- [ ] 建议推荐

### 统计页 (statistics)
- [ ] 数据统计图表
- [ ] 时间范围筛选
- [ ] 趋势分析

### 个人中心 (profile)
- [ ] 个人信息展示
- [ ] 设置修改
- [ ] 账户管理

## 🐛 常见问题排查

### 1. 网络请求失败
- 检查后端服务是否启动
- 确认API地址配置正确
- 查看浏览器控制台错误信息

### 2. 认证失败
- 验证token是否正确保存
- 检查请求头是否包含Authorization
- 确认用户凭据是否有效

### 3. 数据显示异常
- 检查API返回数据格式
- 验证前端数据解析逻辑
- 查看网络请求响应内容

### 4. CORS错误
- 确认后端CORS配置
- 检查请求域名是否在允许列表
- 验证请求方法和头部

## 📈 性能监控

### 关键指标
- API响应时间 < 500ms
- 页面加载时间 < 2s
- 数据更新延迟 < 1s

### 监控工具
- 浏览器开发者工具
- Network面板查看请求
- Console面板查看日志

## 🎉 联调成功标准

- ✅ 用户能够正常登录和登出
- ✅ 首页数据正确加载和显示
- ✅ 快速记录功能正常工作
- ✅ API接口响应正常
- ✅ 错误处理机制有效
- ✅ 数据实时更新正常

## 🔄 后续优化

1. **性能优化**
   - 实现数据缓存
   - 添加加载状态
   - 优化网络请求

2. **用户体验**
   - 添加离线支持
   - 实现数据同步
   - 优化错误提示

3. **功能完善**
   - 完成所有页面联调
   - 添加数据验证
   - 实现文件上传

---

## 📞 技术支持

如遇到联调问题，请检查：
1. 控制台错误信息
2. 网络请求详情
3. 后端日志输出
4. API文档说明

**联调状态**: ✅ 基础功能已完成，可以进行深度测试 