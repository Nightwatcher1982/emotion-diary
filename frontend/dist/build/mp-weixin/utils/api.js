"use strict";const e=require("../common/vendor.js"),t=async(t,n={})=>{const i=o(),a={headers:{"Content-Type":"application/json",...i&&{Authorization:`Token ${i}`}}},d={...a,...n,headers:{...a.headers,...n.headers}};try{const o=await fetch(`http://127.0.0.1:8000/api/v1${t}`,d);if(!o.ok){if(401===o.status)throw r(),s(),e.index.reLaunch({url:"/pages/login/login"}),new Error("登录已过期，请重新登录");throw new Error(`HTTP error! status: ${o.status}`)}return await o.json()}catch(h){throw console.error("API请求失败:",h),h}},o=()=>e.index.getStorageSync("token")||null,r=()=>{e.index.removeStorageSync("token")},s=()=>{e.index.removeStorageSync("user")},n={login:e=>t("/auth/login/",{method:"POST",body:JSON.stringify(e)}),register:e=>t("/auth/register/",{method:"POST",body:JSON.stringify(e)}),sendSMS:e=>t("/auth/sms/send/",{method:"POST",body:JSON.stringify(e)}),phoneLogin:e=>t("/auth/phone/login/",{method:"POST",body:JSON.stringify(e)}),phoneRegister:e=>t("/auth/phone/register/",{method:"POST",body:JSON.stringify(e)}),wechatLogin:e=>t("/auth/wechat/login/",{method:"POST",body:JSON.stringify(e)}),getUserInfo:()=>t("/auth/profile/",{method:"GET"}),updateUserInfo:e=>t("/auth/profile/",{method:"PUT",body:JSON.stringify(e)}),updateProfile:e=>t("/auth/profile/",{method:"PATCH",body:JSON.stringify(e)}),logout:()=>t("/auth/logout/",{method:"POST"})},i={createRecord:e=>t("/emotions/records/",{method:"POST",body:JSON.stringify(e)}),getRecords:e=>{const o=e?new URLSearchParams(e).toString():"";return t("/emotions/records/"+(o?"?"+o:""),{method:"GET"})},getTodayRecords:()=>t("/emotions/records/today/",{method:"GET"}),getRecentRecords:()=>t("/emotions/records/recent/",{method:"GET"}),getRecord:e=>t(`/emotions/records/${e}/`,{method:"GET"}),updateRecord:(e,o)=>t(`/emotions/records/${e}/`,{method:"PUT",body:JSON.stringify(o)}),deleteRecord:e=>t(`/emotions/records/${e}/`,{method:"DELETE"})},a={getAnalysis:e=>t(`/ai/analysis/${e}/`,{method:"GET"}),getAnalysisHistory:e=>{const o=e?new URLSearchParams(e).toString():"";return t("/ai/analysis/history/"+(o?"?"+o:""),{method:"GET"})},realtimeAnalysis:e=>t("/ai/analysis/realtime/",{method:"POST",body:JSON.stringify(e)})};exports.aiAPI=a,exports.authAPI=n,exports.emotionAPI=i,exports.getToken=o,exports.getUser=()=>{const t=e.index.getStorageSync("user");return t?JSON.parse(t):null},exports.setToken=t=>{e.index.setStorageSync("token",t)},exports.setUser=t=>{e.index.setStorageSync("user",JSON.stringify(t))};
