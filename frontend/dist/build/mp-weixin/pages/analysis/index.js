"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js"),i=e.defineComponent({__name:"index",setup(i){const n=e.ref(!0),o=e.ref(0),a=e.ref({}),c=e.ref([{type:"immediate",title:"即时缓解",icon:"⚡"},{type:"longterm",title:"长期改善",icon:"🎯"},{type:"lifestyle",title:"生活方式",icon:"🌱"},{type:"social",title:"社交支持",icon:"👥"}]),s=e.computed(()=>{if(!a.value.suggestions)return[];const e=c.value[o.value].type;return a.value.suggestions[e]||[]}),l=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=e=>({easy:"容易",medium:"中等",hard:"困难"}[e]||"中等"),r=e=>"上升"===e?"trend-up":"下降"===e?"trend-down":"trend-stable",p=e=>(null==e?void 0:e.ai_powered)?"AI驱动":"数据分析",u=t=>{e.index.showModal({title:"应用建议",content:`确定要将"${t.title}"添加到今日计划吗？`,success:t=>{t.confirm&&e.index.showToast({title:"已添加到计划",icon:"success"})}})},m=()=>{e.index.share({provider:"weixin",type:0,title:"我的情绪分析报告",summary:"通过AI分析，我对自己的情绪有了更深的了解",success:()=>{e.index.showToast({title:"分享成功",icon:"success"})}})},y=()=>{e.index.switchTab({url:"/pages/record/index"})},f=async()=>{e.index.showModal({title:"重新分析",content:"将基于最新的情绪记录重新进行AI分析，是否继续？",success:async e=>{e.confirm&&await h()}})},g=async()=>{try{const t={analysis_data:a.value,created_at:(new Date).toISOString(),analysis_type:"comprehensive"};e.index.setStorageSync("latest_analysis",t),e.index.showToast({title:"分析结果已保存",icon:"success"})}catch(t){console.error("保存分析结果失败:",t),e.index.showToast({title:"保存失败",icon:"none"})}},v=e=>{console.log("图表触摸事件",e)},h=async i=>{try{if(!t.getToken())return e.index.showToast({title:"请先登录",icon:"none"}),void e.index.navigateTo({url:"/pages/login/index"});n.value=!0;let o=[];if(i){o=[await t.emotionAPI.getRecordById(i)]}else{const e=await t.emotionAPI.getRecentRecords();o=e.results||e}if(!o||0===o.length)return e.index.showModal({title:"暂无数据",content:"还没有情绪记录，请先记录一些情绪数据",success:t=>{t.confirm&&e.index.switchTab({url:"/pages/record/index"})}}),void(n.value=!1);const c={emotion_records:o.map(e=>e.id),analysis_type:"comprehensive",include_suggestions:!0,include_trend:!0},s=await t.aiAPI.requestAnalysis(c);a.value=x(s,o),n.value=!1}catch(o){console.error("获取分析数据失败:",o),n.value=!1,e.index.showToast({title:"AI分析服务暂时不可用，显示示例数据",icon:"none",duration:3e3}),setTimeout(()=>{a.value={timestamp:Date.now(),primaryEmotion:{name:"焦虑",icon:"😟",confidence:85},emotionSpectrum:[{name:"焦虑",percentage:45},{name:"担心",percentage:30},{name:"紧张",percentage:15},{name:"不安",percentage:10}],insights:[{type:"pattern",icon:"🔍",title:"情绪模式识别",content:"你的焦虑情绪主要出现在工作场景中，特别是面对截止日期时。这是一种常见的适应性焦虑，说明你对工作很负责。"},{type:"trigger",icon:"⚡",title:"触发因素分析",content:'分析显示，时间压力和完美主义倾向是你焦虑的主要触发因素。建议学习时间管理技巧和接受"足够好"的标准。'},{type:"strength",icon:"💪",title:"情绪优势",content:"你具有很好的情绪觉察能力，能够准确识别和描述自己的感受。这是情绪管理的重要基础。"}],suggestions:{immediate:[{id:1,title:"4-7-8呼吸法",description:"吸气4秒，屏气7秒，呼气8秒。重复3-4次可快速缓解焦虑。",difficulty:"easy"},{id:2,title:"5-4-3-2-1接地技巧",description:"说出5个看到的、4个听到的、3个摸到的、2个闻到的、1个尝到的。",difficulty:"easy"}],longterm:[{id:3,title:"认知重构练习",description:"识别并挑战消极思维模式，用更平衡的想法替代。",difficulty:"medium"},{id:4,title:"正念冥想",description:"每天10-15分钟的正念练习，提高情绪调节能力。",difficulty:"medium"}],lifestyle:[{id:5,title:"规律运动",description:"每周3-4次有氧运动，每次30分钟，有助于缓解焦虑。",difficulty:"medium"},{id:6,title:"睡眠优化",description:"建立规律的睡眠时间，创造良好的睡眠环境。",difficulty:"hard"}],social:[{id:7,title:"寻求支持",description:"与信任的朋友或家人分享你的感受，获得情感支持。",difficulty:"medium"},{id:8,title:"专业咨询",description:"如果焦虑持续影响生活，考虑寻求专业心理咨询师的帮助。",difficulty:"hard"}]},trend:{average:6.5,volatility:"中等",direction:"稳定"},deepAnalysis:{score:78,dimensions:[{name:"情绪觉察",score:8,description:"能够准确识别自己的情绪状态"},{name:"应对策略",score:6,description:"具备一定的情绪调节技巧，但需要加强"},{name:"社会支持",score:7,description:"拥有良好的社会支持网络"},{name:"生活平衡",score:5,description:"工作与生活平衡需要改善"}]},actionPlan:[{title:"练习深呼吸",description:"每天早晨练习5分钟深呼吸",completed:!1},{title:"记录触发因素",description:"观察并记录引起焦虑的具体情况",completed:!1},{title:"尝试正念练习",description:"下载冥想App，尝试10分钟正念练习",completed:!1},{title:"制定时间计划",description:"为重要任务制定详细的时间计划",completed:!1},{title:"与朋友交流",description:"主动与一位朋友分享近期的感受",completed:!1},{title:"评估进展",description:"回顾本周的情绪变化和应对效果",completed:!1},{title:"调整策略",description:"根据一周的实践调整应对策略",completed:!1}]}},1e3)}},x=(e,t)=>{const i=t[0];return{timestamp:Date.now(),recordId:i.id,primaryEmotion:{name:w(i.emotion_type),icon:_(i.emotion_type),confidence:e.confidence||85},emotionSpectrum:A(i,e),insights:T(e.insights||[]),suggestions:b(e.suggestions||{}),trend:P(e.trend||{}),deepAnalysis:S(e.deep_analysis||{}),actionPlan:M(e.action_plan||[])}},w=e=>({happy:"快乐",sad:"悲伤",angry:"愤怒",anxious:"焦虑",calm:"平静",fearful:"恐惧"}[e]||"未知"),_=e=>({happy:"😄",sad:"😢",angry:"😡",anxious:"😟",calm:"😌",fearful:"😨"}[e]||"😐"),A=(e,t)=>{const i=t.emotion_spectrum||[];if(i.length>0)return i.map(e=>({name:w(e.emotion),percentage:Math.round(100*e.confidence)}));const n=e.intensity||5;return[{name:w(e.emotion_type),percentage:10*n},{name:"中性",percentage:Math.max(0,100-10*n)}]},T=e=>0===e.length?[{type:"pattern",icon:"🔍",title:"情绪模式识别",content:"正在分析您的情绪模式，请多记录几次以获得更准确的分析。"}]:e.map(e=>({type:e.type||"general",icon:I(e.type),title:e.title||"AI洞察",content:e.content||e.description||""})),I=e=>({pattern:"🔍",trigger:"⚡",strength:"💪",recommendation:"💡",trend:"📈",warning:"⚠️"}[e]||"💭"),b=e=>{const t={immediate:[{id:1,title:"深呼吸练习",description:"进行3-5次深呼吸，帮助快速缓解紧张情绪。",difficulty:"easy"}],longterm:[{id:2,title:"情绪日记",description:"坚持记录情绪变化，提高情绪觉察能力。",difficulty:"medium"}],lifestyle:[{id:3,title:"规律作息",description:"保持规律的睡眠和饮食习惯。",difficulty:"medium"}],social:[{id:4,title:"寻求支持",description:"与信任的人分享你的感受。",difficulty:"easy"}]};return{immediate:e.immediate||t.immediate,longterm:e.longterm||t.longterm,lifestyle:e.lifestyle||t.lifestyle,social:e.social||t.social}},P=e=>({average:e.average||5,volatility:e.volatility||"中等",direction:e.direction||"稳定"}),S=e=>({score:e.score||70,dimensions:e.dimensions||[{name:"情绪觉察",score:7,description:"能够识别自己的情绪状态"},{name:"应对策略",score:6,description:"具备基本的情绪调节能力"}]}),M=e=>0===e.length?[{title:"记录情绪",description:"每天记录一次情绪状态",completed:!1},{title:"练习放松",description:"尝试深呼吸或冥想",completed:!1},{title:"评估进展",description:"回顾一周的情绪变化",completed:!1}]:e.map(e=>({title:e.title||e.name||"",description:e.description||"",completed:e.completed||!1}));return e.onMounted(()=>{const e=getCurrentPages(),t=(e[e.length-1].options||{}).recordId;h(t)}),(t,i)=>{var h,x,w;return e.e({a:!n.value},n.value?{}:{b:e.t((w=a.value,(null==w?void 0:w.ai_powered)?"🤖":"📊")),c:e.t(p(a.value)),d:(null==(h=a.value)?void 0:h.ai_powered)?1:"",e:e.o(g),f:e.o(f)},{g:n.value},n.value?{}:e.e({h:e.t(l(a.value.timestamp)),i:e.t(a.value.primaryEmotion.icon),j:e.t(a.value.primaryEmotion.name),k:e.t(a.value.primaryEmotion.confidence),l:a.value.emotionSpectrum},a.value.emotionSpectrum?{m:e.f(a.value.emotionSpectrum,(t,i,n)=>({a:e.t(t.name),b:t.percentage+"%",c:e.t(t.percentage),d:t.name}))}:{},{n:e.f(a.value.insights,(t,i,n)=>e.e({a:e.t(t.icon),b:e.t(t.title),c:e.o(i=>{return n=t,void e.index.setClipboardData({data:`AI洞察: ${n.content}`,success:()=>{e.index.showToast({title:"已复制到剪贴板",icon:"success"})}});var n},t.type),d:e.t(t.content),e:t.actionable},t.actionable?{f:e.o(i=>(t=>{e.index.showToast({title:"已添加到行动计划",icon:"success"});const i={title:`实践：${t.title}`,description:t.content,completed:!1};a.value.actionPlan&&a.value.actionPlan.push(i)})(t),t.type)}:{},{g:t.type})),o:e.f(c.value,(t,i,n)=>({a:e.t(t.icon),b:e.t(t.title),c:t.type,d:o.value===i?1:"",e:e.o(e=>(e=>{o.value=e})(i),t.type)})),p:e.f(e.unref(s),(t,i,n)=>({a:e.t(t.title),b:e.t(d(t.difficulty)),c:e.n(t.difficulty),d:e.t(t.description),e:e.o(e=>u(t),t.id),f:e.o(t=>{e.index.showToast({title:"已收藏",icon:"success"})},t.id),g:e.o(i=>(t=>{e.index.showModal({title:t.title,content:`${t.description}\n\n难度：${d(t.difficulty)}\n\n是否要将此建议添加到今日计划中？`,confirmText:"添加",cancelText:"取消",success:e=>{e.confirm&&u(t)}})})(t),t.id),h:t.id})),q:a.value.trend},a.value.trend?{r:e.o(v),s:e.t(a.value.trend.average),t:e.t(a.value.trend.volatility),v:e.t((x=a.value.trend.direction,x||"稳定")),w:e.n(r(a.value.trend.direction))}:{},{x:a.value.deepAnalysis},a.value.deepAnalysis?{y:e.t(a.value.deepAnalysis.score),z:e.f(a.value.deepAnalysis.dimensions,(t,i,n)=>({a:e.t(t.name),b:e.t(t.score),c:t.score/10*100+"%",d:e.t(t.description),e:t.name}))}:{},{A:e.f(a.value.actionPlan,(t,i,n)=>e.e({a:t.completed?1:"",b:e.t(i+1),c:e.t(t.title),d:e.t(t.description),e:!t.completed},t.completed?{}:{f:e.o(t=>(t=>{a.value.actionPlan&&a.value.actionPlan[t]&&(a.value.actionPlan[t].completed=!0,e.index.showToast({title:"任务完成！",icon:"success"}))})(i),i)},{g:i}))}),{B:!n.value},n.value?{}:{C:e.o(m),D:e.o(y)})}}}),n=e._export_sfc(i,[["__scopeId","data-v-fe0ee01d"]]);wx.createPage(n);
