"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js"),i=e.defineComponent({__name:"index",setup(i){const n=e.ref(!0),o=e.ref(0),a=e.ref({}),c=e.ref([{type:"immediate",title:"å³æ—¶ç¼“è§£",icon:"âš¡"},{type:"longterm",title:"é•¿æœŸæ”¹å–„",icon:"ğŸ¯"},{type:"lifestyle",title:"ç”Ÿæ´»æ–¹å¼",icon:"ğŸŒ±"},{type:"social",title:"ç¤¾äº¤æ”¯æŒ",icon:"ğŸ‘¥"}]),s=e.computed(()=>{if(!a.value.suggestions)return[];const e=c.value[o.value].type;return a.value.suggestions[e]||[]}),l=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=e=>({easy:"å®¹æ˜“",medium:"ä¸­ç­‰",hard:"å›°éš¾"}[e]||"ä¸­ç­‰"),r=e=>"ä¸Šå‡"===e?"trend-up":"ä¸‹é™"===e?"trend-down":"trend-stable",p=e=>(null==e?void 0:e.ai_powered)?"AIé©±åŠ¨":"æ•°æ®åˆ†æ",u=t=>{e.index.showModal({title:"åº”ç”¨å»ºè®®",content:`ç¡®å®šè¦å°†"${t.title}"æ·»åŠ åˆ°ä»Šæ—¥è®¡åˆ’å—ï¼Ÿ`,success:t=>{t.confirm&&e.index.showToast({title:"å·²æ·»åŠ åˆ°è®¡åˆ’",icon:"success"})}})},m=()=>{e.index.share({provider:"weixin",type:0,title:"æˆ‘çš„æƒ…ç»ªåˆ†ææŠ¥å‘Š",summary:"é€šè¿‡AIåˆ†æï¼Œæˆ‘å¯¹è‡ªå·±çš„æƒ…ç»ªæœ‰äº†æ›´æ·±çš„äº†è§£",success:()=>{e.index.showToast({title:"åˆ†äº«æˆåŠŸ",icon:"success"})}})},y=()=>{e.index.switchTab({url:"/pages/record/index"})},f=async()=>{e.index.showModal({title:"é‡æ–°åˆ†æ",content:"å°†åŸºäºæœ€æ–°çš„æƒ…ç»ªè®°å½•é‡æ–°è¿›è¡ŒAIåˆ†æï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ",success:async e=>{e.confirm&&await h()}})},g=async()=>{try{const t={analysis_data:a.value,created_at:(new Date).toISOString(),analysis_type:"comprehensive"};e.index.setStorageSync("latest_analysis",t),e.index.showToast({title:"åˆ†æç»“æœå·²ä¿å­˜",icon:"success"})}catch(t){console.error("ä¿å­˜åˆ†æç»“æœå¤±è´¥:",t),e.index.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none"})}},v=e=>{console.log("å›¾è¡¨è§¦æ‘¸äº‹ä»¶",e)},h=async i=>{try{if(!t.getToken())return e.index.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}),void e.index.navigateTo({url:"/pages/login/index"});n.value=!0;let o=[];if(i){o=[await t.emotionAPI.getRecordById(i)]}else{const e=await t.emotionAPI.getRecentRecords();o=e.results||e}if(!o||0===o.length)return e.index.showModal({title:"æš‚æ— æ•°æ®",content:"è¿˜æ²¡æœ‰æƒ…ç»ªè®°å½•ï¼Œè¯·å…ˆè®°å½•ä¸€äº›æƒ…ç»ªæ•°æ®",success:t=>{t.confirm&&e.index.switchTab({url:"/pages/record/index"})}}),void(n.value=!1);const c={emotion_records:o.map(e=>e.id),analysis_type:"comprehensive",include_suggestions:!0,include_trend:!0},s=await t.aiAPI.requestAnalysis(c);a.value=x(s,o),n.value=!1}catch(o){console.error("è·å–åˆ†ææ•°æ®å¤±è´¥:",o),n.value=!1,e.index.showToast({title:"AIåˆ†ææœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºç¤ºä¾‹æ•°æ®",icon:"none",duration:3e3}),setTimeout(()=>{a.value={timestamp:Date.now(),primaryEmotion:{name:"ç„¦è™‘",icon:"ğŸ˜Ÿ",confidence:85},emotionSpectrum:[{name:"ç„¦è™‘",percentage:45},{name:"æ‹…å¿ƒ",percentage:30},{name:"ç´§å¼ ",percentage:15},{name:"ä¸å®‰",percentage:10}],insights:[{type:"pattern",icon:"ğŸ”",title:"æƒ…ç»ªæ¨¡å¼è¯†åˆ«",content:"ä½ çš„ç„¦è™‘æƒ…ç»ªä¸»è¦å‡ºç°åœ¨å·¥ä½œåœºæ™¯ä¸­ï¼Œç‰¹åˆ«æ˜¯é¢å¯¹æˆªæ­¢æ—¥æœŸæ—¶ã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„é€‚åº”æ€§ç„¦è™‘ï¼Œè¯´æ˜ä½ å¯¹å·¥ä½œå¾ˆè´Ÿè´£ã€‚"},{type:"trigger",icon:"âš¡",title:"è§¦å‘å› ç´ åˆ†æ",content:'åˆ†ææ˜¾ç¤ºï¼Œæ—¶é—´å‹åŠ›å’Œå®Œç¾ä¸»ä¹‰å€¾å‘æ˜¯ä½ ç„¦è™‘çš„ä¸»è¦è§¦å‘å› ç´ ã€‚å»ºè®®å­¦ä¹ æ—¶é—´ç®¡ç†æŠ€å·§å’Œæ¥å—"è¶³å¤Ÿå¥½"çš„æ ‡å‡†ã€‚'},{type:"strength",icon:"ğŸ’ª",title:"æƒ…ç»ªä¼˜åŠ¿",content:"ä½ å…·æœ‰å¾ˆå¥½çš„æƒ…ç»ªè§‰å¯Ÿèƒ½åŠ›ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å’Œæè¿°è‡ªå·±çš„æ„Ÿå—ã€‚è¿™æ˜¯æƒ…ç»ªç®¡ç†çš„é‡è¦åŸºç¡€ã€‚"}],suggestions:{immediate:[{id:1,title:"4-7-8å‘¼å¸æ³•",description:"å¸æ°”4ç§’ï¼Œå±æ°”7ç§’ï¼Œå‘¼æ°”8ç§’ã€‚é‡å¤3-4æ¬¡å¯å¿«é€Ÿç¼“è§£ç„¦è™‘ã€‚",difficulty:"easy"},{id:2,title:"5-4-3-2-1æ¥åœ°æŠ€å·§",description:"è¯´å‡º5ä¸ªçœ‹åˆ°çš„ã€4ä¸ªå¬åˆ°çš„ã€3ä¸ªæ‘¸åˆ°çš„ã€2ä¸ªé—»åˆ°çš„ã€1ä¸ªå°åˆ°çš„ã€‚",difficulty:"easy"}],longterm:[{id:3,title:"è®¤çŸ¥é‡æ„ç»ƒä¹ ",description:"è¯†åˆ«å¹¶æŒ‘æˆ˜æ¶ˆææ€ç»´æ¨¡å¼ï¼Œç”¨æ›´å¹³è¡¡çš„æƒ³æ³•æ›¿ä»£ã€‚",difficulty:"medium"},{id:4,title:"æ­£å¿µå†¥æƒ³",description:"æ¯å¤©10-15åˆ†é’Ÿçš„æ­£å¿µç»ƒä¹ ï¼Œæé«˜æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›ã€‚",difficulty:"medium"}],lifestyle:[{id:5,title:"è§„å¾‹è¿åŠ¨",description:"æ¯å‘¨3-4æ¬¡æœ‰æ°§è¿åŠ¨ï¼Œæ¯æ¬¡30åˆ†é’Ÿï¼Œæœ‰åŠ©äºç¼“è§£ç„¦è™‘ã€‚",difficulty:"medium"},{id:6,title:"ç¡çœ ä¼˜åŒ–",description:"å»ºç«‹è§„å¾‹çš„ç¡çœ æ—¶é—´ï¼Œåˆ›é€ è‰¯å¥½çš„ç¡çœ ç¯å¢ƒã€‚",difficulty:"hard"}],social:[{id:7,title:"å¯»æ±‚æ”¯æŒ",description:"ä¸ä¿¡ä»»çš„æœ‹å‹æˆ–å®¶äººåˆ†äº«ä½ çš„æ„Ÿå—ï¼Œè·å¾—æƒ…æ„Ÿæ”¯æŒã€‚",difficulty:"medium"},{id:8,title:"ä¸“ä¸šå’¨è¯¢",description:"å¦‚æœç„¦è™‘æŒç»­å½±å“ç”Ÿæ´»ï¼Œè€ƒè™‘å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆçš„å¸®åŠ©ã€‚",difficulty:"hard"}]},trend:{average:6.5,volatility:"ä¸­ç­‰",direction:"ç¨³å®š"},deepAnalysis:{score:78,dimensions:[{name:"æƒ…ç»ªè§‰å¯Ÿ",score:8,description:"èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«è‡ªå·±çš„æƒ…ç»ªçŠ¶æ€"},{name:"åº”å¯¹ç­–ç•¥",score:6,description:"å…·å¤‡ä¸€å®šçš„æƒ…ç»ªè°ƒèŠ‚æŠ€å·§ï¼Œä½†éœ€è¦åŠ å¼º"},{name:"ç¤¾ä¼šæ”¯æŒ",score:7,description:"æ‹¥æœ‰è‰¯å¥½çš„ç¤¾ä¼šæ”¯æŒç½‘ç»œ"},{name:"ç”Ÿæ´»å¹³è¡¡",score:5,description:"å·¥ä½œä¸ç”Ÿæ´»å¹³è¡¡éœ€è¦æ”¹å–„"}]},actionPlan:[{title:"ç»ƒä¹ æ·±å‘¼å¸",description:"æ¯å¤©æ—©æ™¨ç»ƒä¹ 5åˆ†é’Ÿæ·±å‘¼å¸",completed:!1},{title:"è®°å½•è§¦å‘å› ç´ ",description:"è§‚å¯Ÿå¹¶è®°å½•å¼•èµ·ç„¦è™‘çš„å…·ä½“æƒ…å†µ",completed:!1},{title:"å°è¯•æ­£å¿µç»ƒä¹ ",description:"ä¸‹è½½å†¥æƒ³Appï¼Œå°è¯•10åˆ†é’Ÿæ­£å¿µç»ƒä¹ ",completed:!1},{title:"åˆ¶å®šæ—¶é—´è®¡åˆ’",description:"ä¸ºé‡è¦ä»»åŠ¡åˆ¶å®šè¯¦ç»†çš„æ—¶é—´è®¡åˆ’",completed:!1},{title:"ä¸æœ‹å‹äº¤æµ",description:"ä¸»åŠ¨ä¸ä¸€ä½æœ‹å‹åˆ†äº«è¿‘æœŸçš„æ„Ÿå—",completed:!1},{title:"è¯„ä¼°è¿›å±•",description:"å›é¡¾æœ¬å‘¨çš„æƒ…ç»ªå˜åŒ–å’Œåº”å¯¹æ•ˆæœ",completed:!1},{title:"è°ƒæ•´ç­–ç•¥",description:"æ ¹æ®ä¸€å‘¨çš„å®è·µè°ƒæ•´åº”å¯¹ç­–ç•¥",completed:!1}]}},1e3)}},x=(e,t)=>{const i=t[0];return{timestamp:Date.now(),recordId:i.id,primaryEmotion:{name:w(i.emotion_type),icon:_(i.emotion_type),confidence:e.confidence||85},emotionSpectrum:A(i,e),insights:T(e.insights||[]),suggestions:b(e.suggestions||{}),trend:P(e.trend||{}),deepAnalysis:S(e.deep_analysis||{}),actionPlan:M(e.action_plan||[])}},w=e=>({happy:"å¿«ä¹",sad:"æ‚²ä¼¤",angry:"æ„¤æ€’",anxious:"ç„¦è™‘",calm:"å¹³é™",fearful:"ææƒ§"}[e]||"æœªçŸ¥"),_=e=>({happy:"ğŸ˜„",sad:"ğŸ˜¢",angry:"ğŸ˜¡",anxious:"ğŸ˜Ÿ",calm:"ğŸ˜Œ",fearful:"ğŸ˜¨"}[e]||"ğŸ˜"),A=(e,t)=>{const i=t.emotion_spectrum||[];if(i.length>0)return i.map(e=>({name:w(e.emotion),percentage:Math.round(100*e.confidence)}));const n=e.intensity||5;return[{name:w(e.emotion_type),percentage:10*n},{name:"ä¸­æ€§",percentage:Math.max(0,100-10*n)}]},T=e=>0===e.length?[{type:"pattern",icon:"ğŸ”",title:"æƒ…ç»ªæ¨¡å¼è¯†åˆ«",content:"æ­£åœ¨åˆ†ææ‚¨çš„æƒ…ç»ªæ¨¡å¼ï¼Œè¯·å¤šè®°å½•å‡ æ¬¡ä»¥è·å¾—æ›´å‡†ç¡®çš„åˆ†æã€‚"}]:e.map(e=>({type:e.type||"general",icon:I(e.type),title:e.title||"AIæ´å¯Ÿ",content:e.content||e.description||""})),I=e=>({pattern:"ğŸ”",trigger:"âš¡",strength:"ğŸ’ª",recommendation:"ğŸ’¡",trend:"ğŸ“ˆ",warning:"âš ï¸"}[e]||"ğŸ’­"),b=e=>{const t={immediate:[{id:1,title:"æ·±å‘¼å¸ç»ƒä¹ ",description:"è¿›è¡Œ3-5æ¬¡æ·±å‘¼å¸ï¼Œå¸®åŠ©å¿«é€Ÿç¼“è§£ç´§å¼ æƒ…ç»ªã€‚",difficulty:"easy"}],longterm:[{id:2,title:"æƒ…ç»ªæ—¥è®°",description:"åšæŒè®°å½•æƒ…ç»ªå˜åŒ–ï¼Œæé«˜æƒ…ç»ªè§‰å¯Ÿèƒ½åŠ›ã€‚",difficulty:"medium"}],lifestyle:[{id:3,title:"è§„å¾‹ä½œæ¯",description:"ä¿æŒè§„å¾‹çš„ç¡çœ å’Œé¥®é£Ÿä¹ æƒ¯ã€‚",difficulty:"medium"}],social:[{id:4,title:"å¯»æ±‚æ”¯æŒ",description:"ä¸ä¿¡ä»»çš„äººåˆ†äº«ä½ çš„æ„Ÿå—ã€‚",difficulty:"easy"}]};return{immediate:e.immediate||t.immediate,longterm:e.longterm||t.longterm,lifestyle:e.lifestyle||t.lifestyle,social:e.social||t.social}},P=e=>({average:e.average||5,volatility:e.volatility||"ä¸­ç­‰",direction:e.direction||"ç¨³å®š"}),S=e=>({score:e.score||70,dimensions:e.dimensions||[{name:"æƒ…ç»ªè§‰å¯Ÿ",score:7,description:"èƒ½å¤Ÿè¯†åˆ«è‡ªå·±çš„æƒ…ç»ªçŠ¶æ€"},{name:"åº”å¯¹ç­–ç•¥",score:6,description:"å…·å¤‡åŸºæœ¬çš„æƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›"}]}),M=e=>0===e.length?[{title:"è®°å½•æƒ…ç»ª",description:"æ¯å¤©è®°å½•ä¸€æ¬¡æƒ…ç»ªçŠ¶æ€",completed:!1},{title:"ç»ƒä¹ æ”¾æ¾",description:"å°è¯•æ·±å‘¼å¸æˆ–å†¥æƒ³",completed:!1},{title:"è¯„ä¼°è¿›å±•",description:"å›é¡¾ä¸€å‘¨çš„æƒ…ç»ªå˜åŒ–",completed:!1}]:e.map(e=>({title:e.title||e.name||"",description:e.description||"",completed:e.completed||!1}));return e.onMounted(()=>{const e=getCurrentPages(),t=(e[e.length-1].options||{}).recordId;h(t)}),(t,i)=>{var h,x,w;return e.e({a:!n.value},n.value?{}:{b:e.t((w=a.value,(null==w?void 0:w.ai_powered)?"ğŸ¤–":"ğŸ“Š")),c:e.t(p(a.value)),d:(null==(h=a.value)?void 0:h.ai_powered)?1:"",e:e.o(g),f:e.o(f)},{g:n.value},n.value?{}:e.e({h:e.t(l(a.value.timestamp)),i:e.t(a.value.primaryEmotion.icon),j:e.t(a.value.primaryEmotion.name),k:e.t(a.value.primaryEmotion.confidence),l:a.value.emotionSpectrum},a.value.emotionSpectrum?{m:e.f(a.value.emotionSpectrum,(t,i,n)=>({a:e.t(t.name),b:t.percentage+"%",c:e.t(t.percentage),d:t.name}))}:{},{n:e.f(a.value.insights,(t,i,n)=>e.e({a:e.t(t.icon),b:e.t(t.title),c:e.o(i=>{return n=t,void e.index.setClipboardData({data:`AIæ´å¯Ÿ: ${n.content}`,success:()=>{e.index.showToast({title:"å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",icon:"success"})}});var n},t.type),d:e.t(t.content),e:t.actionable},t.actionable?{f:e.o(i=>(t=>{e.index.showToast({title:"å·²æ·»åŠ åˆ°è¡ŒåŠ¨è®¡åˆ’",icon:"success"});const i={title:`å®è·µï¼š${t.title}`,description:t.content,completed:!1};a.value.actionPlan&&a.value.actionPlan.push(i)})(t),t.type)}:{},{g:t.type})),o:e.f(c.value,(t,i,n)=>({a:e.t(t.icon),b:e.t(t.title),c:t.type,d:o.value===i?1:"",e:e.o(e=>(e=>{o.value=e})(i),t.type)})),p:e.f(e.unref(s),(t,i,n)=>({a:e.t(t.title),b:e.t(d(t.difficulty)),c:e.n(t.difficulty),d:e.t(t.description),e:e.o(e=>u(t),t.id),f:e.o(t=>{e.index.showToast({title:"å·²æ”¶è—",icon:"success"})},t.id),g:e.o(i=>(t=>{e.index.showModal({title:t.title,content:`${t.description}\n\néš¾åº¦ï¼š${d(t.difficulty)}\n\næ˜¯å¦è¦å°†æ­¤å»ºè®®æ·»åŠ åˆ°ä»Šæ—¥è®¡åˆ’ä¸­ï¼Ÿ`,confirmText:"æ·»åŠ ",cancelText:"å–æ¶ˆ",success:e=>{e.confirm&&u(t)}})})(t),t.id),h:t.id})),q:a.value.trend},a.value.trend?{r:e.o(v),s:e.t(a.value.trend.average),t:e.t(a.value.trend.volatility),v:e.t((x=a.value.trend.direction,x||"ç¨³å®š")),w:e.n(r(a.value.trend.direction))}:{},{x:a.value.deepAnalysis},a.value.deepAnalysis?{y:e.t(a.value.deepAnalysis.score),z:e.f(a.value.deepAnalysis.dimensions,(t,i,n)=>({a:e.t(t.name),b:e.t(t.score),c:t.score/10*100+"%",d:e.t(t.description),e:t.name}))}:{},{A:e.f(a.value.actionPlan,(t,i,n)=>e.e({a:t.completed?1:"",b:e.t(i+1),c:e.t(t.title),d:e.t(t.description),e:!t.completed},t.completed?{}:{f:e.o(t=>(t=>{a.value.actionPlan&&a.value.actionPlan[t]&&(a.value.actionPlan[t].completed=!0,e.index.showToast({title:"ä»»åŠ¡å®Œæˆï¼",icon:"success"}))})(i),i)},{g:i}))}),{B:!n.value},n.value?{}:{C:e.o(m),D:e.o(y)})}}}),n=e._export_sfc(i,[["__scopeId","data-v-fe0ee01d"]]);wx.createPage(n);
