"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js"),a=e.defineComponent({__name:"history",setup(a){const n=e.ref([]),s=e.ref(!1),r=e.ref(!0),i=e.ref(1),u=e.ref(0),l=e.ref(0),o=e.ref(["å…¨éƒ¨æ—¶é—´","æœ€è¿‘ä¸€å‘¨","æœ€è¿‘ä¸€æœˆ","æœ€è¿‘ä¸‰æœˆ"]),c=e.ref(["æŒ‰æ—¶é—´æŽ’åº","æŒ‰è¯„åˆ†æŽ’åº","æŒ‰ç½®ä¿¡åº¦æŽ’åº"]),g=e.computed(()=>n.value.length),d=e.computed(()=>{if(0===n.value.length)return"0.0";return(n.value.reduce((e,t)=>e+(t.user_rating||0),0)/n.value.length).toFixed(1)}),v=e.computed(()=>{let e=[...n.value];const t=new Date;switch(u.value){case 1:const a=new Date(t.getTime()-6048e5);e=e.filter(e=>new Date(e.created_at)>=a);break;case 2:const n=new Date(t.getTime()-2592e6);e=e.filter(e=>new Date(e.created_at)>=n);break;case 3:const s=new Date(t.getTime()-7776e6);e=e.filter(e=>new Date(e.created_at)>=s)}switch(l.value){case 0:e.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());break;case 1:e.sort((e,t)=>(t.user_rating||0)-(e.user_rating||0));break;case 2:e.sort((e,t)=>t.confidence_score-e.confidence_score)}return e}),f=async(a=1)=>{try{s.value=!0;const e=await t.aiAPI.getAnalysisHistory({page:a,page_size:10});1===a?n.value=e.results||[]:n.value.push(...e.results||[]),r.value=!!e.next,i.value=a}catch(u){console.error("åŠ è½½åˆ†æžåŽ†å²å¤±è´¥:",u),e.index.showToast({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{s.value=!1}},h=()=>{r.value&&!s.value&&f(i.value+1)},_=e=>{u.value=e.detail.value},m=e=>{l.value=e.detail.value},p=e=>{const t=new Date(e),a=(new Date).getTime()-t.getTime(),n=Math.floor(a/864e5);if(0===n)return"ä»Šå¤©";if(1===n)return"æ˜¨å¤©";if(n<7)return`${n}å¤©å‰`;return`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`},y=e=>{const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},w=e=>({happy:"å¿«ä¹",sad:"æ‚²ä¼¤",angry:"æ„¤æ€’",anxious:"ç„¦è™‘",excited:"å…´å¥‹",calm:"å¹³é™",confused:"å›°æƒ‘"}[e]||"æœªçŸ¥"),x=e=>e>=80?"status-high":e>=60?"status-medium":"status-low",D=()=>{e.index.switchTab({url:"/pages/record/index"})};return e.onMounted(()=>{f()}),(t,a)=>e.e({a:e.t(e.unref(g)),b:e.t(e.unref(d)),c:e.t(o.value[u.value]),d:o.value,e:u.value,f:e.o(_),g:e.t(c.value[l.value]),h:c.value,i:l.value,j:e.o(m),k:e.f(e.unref(v),(t,a,n)=>{var s,r,i;return e.e({a:e.t(p(t.created_at)),b:e.t(y(t.created_at)),c:e.t((i=t.confidence_score,i>=80?"é«˜ç½®ä¿¡åº¦":i>=60?"ä¸­ç½®ä¿¡åº¦":"ä½Žç½®ä¿¡åº¦")),d:e.n(x(t.confidence_score)),e:e.t((r=t.primary_emotion,{happy:"ðŸ˜Š",sad:"ðŸ˜¢",angry:"ðŸ˜ ",anxious:"ðŸ˜°",excited:"ðŸ¤©",calm:"ðŸ˜Œ",confused:"ðŸ˜•"}[r]||"ðŸ˜")),f:e.t(w(t.primary_emotion)),g:10*t.intensity_level+"%",h:e.t(t.intensity_level),i:e.t((null==(s=t.key_insights[0])?void 0:s.content)||"æš‚æ— æ´žå¯Ÿ"),j:t.key_insights.length>1},t.key_insights.length>1?{k:e.t(t.key_insights.length-1)}:{},{l:t.suggestions.length>0},t.suggestions.length>0?e.e({m:e.f(t.suggestions.slice(0,3),(t,a,n)=>({a:e.t(t.title),b:a})),n:t.suggestions.length>3},t.suggestions.length>3?{o:e.t(t.suggestions.length-3)}:{}):{},{p:t.confidence_score+"%",q:e.t(t.confidence_score),r:t.id,s:e.o(a=>(t=>{e.index.navigateTo({url:`/pages/analysis/index?analysisId=${t.id}`})})(t),t.id)})}),l:s.value},(s.value,{}),{m:!s.value&&0===e.unref(v).length},s.value||0!==e.unref(v).length?{}:{n:e.o(D)},{o:r.value&&!s.value},r.value&&!s.value?{p:e.o(h)}:{})}}),n=e._export_sfc(a,[["__scopeId","data-v-05b71762"]]);wx.createPage(n);
