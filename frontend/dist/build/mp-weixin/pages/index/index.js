"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js"),n=e.defineComponent({__name:"index",setup(n){const a=e.ref("小明"),i=e.ref(null),o=e.ref([]),s=e.ref(!0),r=e.ref(null),l=e.ref({icon:"☀️",desc:"晴朗"}),c=e.ref([{name:"快乐",icon:"😄",type:"happy"},{name:"平静",icon:"😌",type:"calm"},{name:"焦虑",icon:"😟",type:"anxious"},{name:"悲伤",icon:"😢",type:"sad"},{name:"愤怒",icon:"😡",type:"angry"},{name:"恐惧",icon:"😨",type:"fearful"}]),u=e.computed(()=>{const e=(new Date).getHours();return e<6?"夜深了":e<12?"早上好":e<18?"下午好":"晚上好"}),d=e.computed(()=>{const e=(new Date).getHours();return e<6?"🌙":e<12?"🌅":e<18?"☀️":"🌆"}),m=e.computed(()=>{const e=new Date;return`${e.getMonth()+1}月${e.getDate()}日 星期${["日","一","二","三","四","五","六"][e.getDay()]}`}),p=()=>{e.index.switchTab({url:"/pages/record/index"})},g=()=>{e.index.switchTab({url:"/pages/statistics/index"})},v=e=>{const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},y=async()=>{s.value=!0;try{const[e,n]=await Promise.all([t.emotionAPI.getTodayRecords(),t.emotionAPI.getRecentRecords()]);if(e&&e.length>0){const t=e[0];i.value={name:f(t.emotion_type),icon:h(t.emotion_type),intensity:t.intensity,scene:x(t.scenario),time:v(t.emotion_time)}}else i.value=null;o.value=n.slice(0,3).map(e=>({id:e.id,emotion:h(e.emotion_type),name:f(e.emotion_type),time:v(e.emotion_time),content:e.description.length>30?e.description.substring(0,30)+"...":e.description}))}catch(n){console.error("加载数据失败:",n),e.index.showToast({title:"数据加载失败",icon:"none"}),"Unauthorized"===(null==n?void 0:n.message)&&e.index.navigateTo({url:"/pages/login/index"})}finally{s.value=!1}},f=e=>({happy:"快乐",sad:"悲伤",angry:"愤怒",anxious:"焦虑",calm:"平静",fearful:"恐惧",excited:"兴奋",frustrated:"沮丧",grateful:"感激",lonely:"孤独",confident:"自信",overwhelmed:"不知所措"}[e]||e),h=e=>({happy:"😊",sad:"😢",angry:"😠",anxious:"😰",calm:"😌",fearful:"😨",excited:"🤩",frustrated:"😤",grateful:"🙏",lonely:"😔",confident:"😎",overwhelmed:"🤯"}[e]||"😊"),x=e=>({work:"工作",study:"学习",family:"家庭",social:"社交",health:"健康",finance:"财务",relationship:"感情",personal:"个人",entertainment:"娱乐",travel:"旅行",other:"其他"}[e]||e);return e.onMounted(()=>{(async()=>{t.getToken()?(r.value=t.getUser(),r.value&&(a.value=r.value.nickname||r.value.username),await y()):e.index.navigateTo({url:"/pages/login/index"})})()}),(n,s)=>e.e({a:e.t(e.unref(u)),b:e.t(a.value||"用户"),c:e.t(e.unref(d)),d:e.t(e.unref(m)),e:l.value},l.value?{f:e.t(l.value.icon),g:e.t(l.value.desc)}:{},{h:i.value},(i.value,{}),{i:e.o(g),j:i.value},i.value?{k:e.t(i.value.icon),l:10*i.value.intensity+"%",m:e.t(i.value.intensity),n:e.t(i.value.name),o:e.t(i.value.scene),p:e.t(i.value.time)}:{q:e.o(p)},{r:e.f(c.value,(n,a,i)=>({a:e.n(n.type),b:e.t(n.icon),c:e.t(n.name),d:n.name,e:e.o(a=>(async n=>{try{e.index.showLoading({title:"记录中..."});const a={emotion_type:n.type,intensity:5,scenario:"personal",description:`快速记录${n.name}情绪`,triggers:["快速记录"],physical_symptoms:[],coping_methods:[]};await t.emotionAPI.createRecord(a),e.index.hideLoading(),e.index.showToast({title:`${n.name}情绪记录成功`,icon:"success"}),await y()}catch(a){e.index.hideLoading(),console.error("快速记录失败:",a),e.index.showToast({title:"记录失败，请重试",icon:"none"})}})(n),n.name)})),s:o.value.length>0},o.value.length>0?{t:e.o(g),v:e.f(o.value,(t,n,a)=>e.e({a:e.t(t.emotion),b:e.t(t.name),c:e.t(t.time),d:e.t(t.content),e:n<o.value.length-1},(o.value.length,{}),{f:t.id,g:e.o(n=>(t=>{e.index.navigateTo({url:`/pages/analysis/index?recordId=${t.id}`})})(t),t.id)}))}:{},{w:e.o(p)})}}),a=e._export_sfc(n,[["__scopeId","data-v-d23669ae"]]);wx.createPage(a);
