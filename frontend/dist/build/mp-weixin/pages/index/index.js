"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js"),n=e.defineComponent({__name:"index",setup(n){const a=e.ref("å°æ˜Ž"),i=e.ref(null),o=e.ref([]),s=e.ref(!0),r=e.ref(null),l=e.ref({icon:"â˜€ï¸",desc:"æ™´æœ—"}),c=e.ref([{name:"å¿«ä¹",icon:"ðŸ˜„",type:"happy"},{name:"å¹³é™",icon:"ðŸ˜Œ",type:"calm"},{name:"ç„¦è™‘",icon:"ðŸ˜Ÿ",type:"anxious"},{name:"æ‚²ä¼¤",icon:"ðŸ˜¢",type:"sad"},{name:"æ„¤æ€’",icon:"ðŸ˜¡",type:"angry"},{name:"ææƒ§",icon:"ðŸ˜¨",type:"fearful"}]),u=e.computed(()=>{const e=(new Date).getHours();return e<6?"å¤œæ·±äº†":e<12?"æ—©ä¸Šå¥½":e<18?"ä¸‹åˆå¥½":"æ™šä¸Šå¥½"}),d=e.computed(()=>{const e=(new Date).getHours();return e<6?"ðŸŒ™":e<12?"ðŸŒ…":e<18?"â˜€ï¸":"ðŸŒ†"}),m=e.computed(()=>{const e=new Date;return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ æ˜ŸæœŸ${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`}),p=()=>{e.index.switchTab({url:"/pages/record/index"})},g=()=>{e.index.switchTab({url:"/pages/statistics/index"})},v=e=>{const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},y=async()=>{s.value=!0;try{const[e,n]=await Promise.all([t.emotionAPI.getTodayRecords(),t.emotionAPI.getRecentRecords()]);if(e&&e.length>0){const t=e[0];i.value={name:f(t.emotion_type),icon:h(t.emotion_type),intensity:t.intensity,scene:x(t.scenario),time:v(t.emotion_time)}}else i.value=null;o.value=n.slice(0,3).map(e=>({id:e.id,emotion:h(e.emotion_type),name:f(e.emotion_type),time:v(e.emotion_time),content:e.description.length>30?e.description.substring(0,30)+"...":e.description}))}catch(n){console.error("åŠ è½½æ•°æ®å¤±è´¥:",n),e.index.showToast({title:"æ•°æ®åŠ è½½å¤±è´¥",icon:"none"}),"Unauthorized"===(null==n?void 0:n.message)&&e.index.navigateTo({url:"/pages/login/index"})}finally{s.value=!1}},f=e=>({happy:"å¿«ä¹",sad:"æ‚²ä¼¤",angry:"æ„¤æ€’",anxious:"ç„¦è™‘",calm:"å¹³é™",fearful:"ææƒ§",excited:"å…´å¥‹",frustrated:"æ²®ä¸§",grateful:"æ„Ÿæ¿€",lonely:"å­¤ç‹¬",confident:"è‡ªä¿¡",overwhelmed:"ä¸çŸ¥æ‰€æŽª"}[e]||e),h=e=>({happy:"ðŸ˜Š",sad:"ðŸ˜¢",angry:"ðŸ˜ ",anxious:"ðŸ˜°",calm:"ðŸ˜Œ",fearful:"ðŸ˜¨",excited:"ðŸ¤©",frustrated:"ðŸ˜¤",grateful:"ðŸ™",lonely:"ðŸ˜”",confident:"ðŸ˜Ž",overwhelmed:"ðŸ¤¯"}[e]||"ðŸ˜Š"),x=e=>({work:"å·¥ä½œ",study:"å­¦ä¹ ",family:"å®¶åº­",social:"ç¤¾äº¤",health:"å¥åº·",finance:"è´¢åŠ¡",relationship:"æ„Ÿæƒ…",personal:"ä¸ªäºº",entertainment:"å¨±ä¹",travel:"æ—…è¡Œ",other:"å…¶ä»–"}[e]||e);return e.onMounted(()=>{(async()=>{t.getToken()?(r.value=t.getUser(),r.value&&(a.value=r.value.nickname||r.value.username),await y()):e.index.navigateTo({url:"/pages/login/index"})})()}),(n,s)=>e.e({a:e.t(e.unref(u)),b:e.t(a.value||"ç”¨æˆ·"),c:e.t(e.unref(d)),d:e.t(e.unref(m)),e:l.value},l.value?{f:e.t(l.value.icon),g:e.t(l.value.desc)}:{},{h:i.value},(i.value,{}),{i:e.o(g),j:i.value},i.value?{k:e.t(i.value.icon),l:10*i.value.intensity+"%",m:e.t(i.value.intensity),n:e.t(i.value.name),o:e.t(i.value.scene),p:e.t(i.value.time)}:{q:e.o(p)},{r:e.f(c.value,(n,a,i)=>({a:e.n(n.type),b:e.t(n.icon),c:e.t(n.name),d:n.name,e:e.o(a=>(async n=>{try{e.index.showLoading({title:"è®°å½•ä¸­..."});const a={emotion_type:n.type,intensity:5,scenario:"personal",description:`å¿«é€Ÿè®°å½•${n.name}æƒ…ç»ª`,triggers:["å¿«é€Ÿè®°å½•"],physical_symptoms:[],coping_methods:[]};await t.emotionAPI.createRecord(a),e.index.hideLoading(),e.index.showToast({title:`${n.name}æƒ…ç»ªè®°å½•æˆåŠŸ`,icon:"success"}),await y()}catch(a){e.index.hideLoading(),console.error("å¿«é€Ÿè®°å½•å¤±è´¥:",a),e.index.showToast({title:"è®°å½•å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})(n),n.name)})),s:o.value.length>0},o.value.length>0?{t:e.o(g),v:e.f(o.value,(t,n,a)=>e.e({a:e.t(t.emotion),b:e.t(t.name),c:e.t(t.time),d:e.t(t.content),e:n<o.value.length-1},(o.value.length,{}),{f:t.id,g:e.o(n=>(t=>{e.index.navigateTo({url:`/pages/analysis/index?recordId=${t.id}`})})(t),t.id)}))}:{},{w:e.o(p)})}}),a=e._export_sfc(n,[["__scopeId","data-v-d23669ae"]]);wx.createPage(a);
