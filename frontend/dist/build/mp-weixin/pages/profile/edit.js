"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/api.js"),t=e.defineComponent({__name:"edit",setup(t){const i=e.ref({nickname:"",bio:"",gender:"N",birth_date:"",avatar:"",notification_enabled:!0,daily_reminder_time:"21:00",theme_preference:"auto",analytics_consent:!0}),n=e.ref(!1),l=e.ref([{value:"M",label:"男",icon:"👨"},{value:"F",label:"女",icon:"👩"},{value:"O",label:"其他",icon:"🧑"},{value:"N",label:"保密",icon:"🤐"}]),o=e.ref(["跟随系统","浅色主题","深色主题"]),u=e.ref(0),r=e.computed(()=>({auto:"跟随系统",light:"浅色主题",dark:"深色主题"}[i.value.theme_preference]||"跟随系统")),c=()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:a=>{i.value.avatar=a.tempFilePaths[0],e.index.showToast({title:"头像已选择",icon:"success"})},fail:()=>{e.index.showToast({title:"选择头像失败",icon:"none"})}})},v=e=>{i.value.birth_date=e.detail.value},d=e=>{const a=e.detail.value;u.value=a;i.value.theme_preference=["auto","light","dark"][a]},s=e=>{i.value.notification_enabled=e.detail.value},_=e=>{i.value.daily_reminder_time=e.detail.value},m=e=>{i.value.analytics_consent=e.detail.value},f=async()=>{var t,l;if(!n.value)try{if(n.value=!0,!i.value.nickname.trim())return void e.index.showToast({title:"请输入昵称",icon:"none"});e.index.showLoading({title:"保存中..."});await a.authAPI.updateProfile(i.value);const t=a.getUser();if(t){const e={...t,...i.value};a.setUser(e)}e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500)}catch(o){e.index.hideLoading(),console.error("保存失败:",o);const a=(null==(l=null==(t=null==o?void 0:o.response)?void 0:t.data)?void 0:l.message)||"保存失败，请重试";e.index.showToast({title:a,icon:"none"})}finally{n.value=!1}};return e.onMounted(()=>{(async()=>{try{const e=a.getUser();if(e){i.value={nickname:e.nickname||"",bio:e.bio||"",gender:e.gender||"N",birth_date:e.birth_date||"",avatar:e.avatar||"",notification_enabled:!1!==e.notification_enabled,daily_reminder_time:e.daily_reminder_time||"21:00",theme_preference:e.theme_preference||"auto",analytics_consent:!1!==e.analytics_consent};const a={auto:0,light:1,dark:2};u.value=a[i.value.theme_preference]||0}}catch(t){console.error("加载用户信息失败:",t),e.index.showToast({title:"加载失败，请重试",icon:"none"})}})()}),(a,t)=>{var h;return e.e({a:i.value.avatar||"/static/default-avatar.png",b:e.o(c),c:i.value.nickname,d:e.o(e=>i.value.nickname=e.detail.value),e:i.value.bio,f:e.o(e=>i.value.bio=e.detail.value),g:e.t((null==(h=i.value.bio)?void 0:h.length)||0),h:e.f(l.value,(a,t,n)=>({a:e.t(a.icon),b:e.t(a.label),c:a.value,d:i.value.gender===a.value?1:"",e:e.o(e=>{return t=a.value,void(i.value.gender=t);var t},a.value)})),i:e.t(i.value.birth_date||"请选择出生日期"),j:i.value.birth_date,k:e.o(v),l:e.t(e.unref(r)),m:o.value,n:u.value,o:e.o(d),p:i.value.notification_enabled,q:e.o(s),r:i.value.notification_enabled},i.value.notification_enabled?{s:e.t(i.value.daily_reminder_time||"21:00"),t:i.value.daily_reminder_time,v:e.o(_)}:{},{w:i.value.analytics_consent,x:e.o(m),y:!n.value},(n.value,{}),{z:n.value},(n.value,{}),{A:e.t(n.value?"保存中...":"保存修改"),B:e.o(f),C:n.value})}}}),i=e._export_sfc(t,[["__scopeId","data-v-16615573"]]);wx.createPage(i);
