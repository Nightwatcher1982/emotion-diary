"use strict";const e=require("../../common/vendor.js"),n=require("../../utils/api.js"),t=e.defineComponent({__name:"index",setup(t){const o=e.ref(1),i=e.ref(!1),s=e.ref(0),a=e.reactive({text:"",emotions:[],intensity:5,scene:"",triggers:[],physicalSymptoms:[],copingMethods:[],enableDeepAnalysis:!1,deepAnswers:[]}),l=e.ref([{name:"å¿«ä¹",icon:"ğŸ˜„",description:"æ„‰æ‚¦ã€å¼€å¿ƒã€æ»¡è¶³"},{name:"ç„¦è™‘",icon:"ğŸ˜Ÿ",description:"ç´§å¼ ã€æ‹…å¿ƒã€ä¸å®‰"},{name:"æ„¤æ€’",icon:"ğŸ˜¡",description:"ç”Ÿæ°”ã€æ„¤æ€’ã€æ¼ç«"},{name:"æ‚²ä¼¤",icon:"ğŸ˜¢",description:"éš¾è¿‡ã€æ²®ä¸§ã€å¤±è½"},{name:"å¹³é™",icon:"ğŸ˜Œ",description:"æ”¾æ¾ã€å¹³å’Œã€å®é™"},{name:"ææƒ§",icon:"ğŸ˜¨",description:"å®³æ€•ã€ææ…Œã€ç•æƒ§"}]),c=e.ref([{name:"å·¥ä½œ",icon:"ğŸ’¼",description:"å·¥ä½œã€èŒåœºã€åŒäº‹å…³ç³»"},{name:"å­¦ä¹ ",icon:"ğŸ“š",description:"å­¦ä¹ ã€è€ƒè¯•ã€å­¦ä¸šå‹åŠ›"},{name:"ç”Ÿæ´»",icon:"ğŸ ",description:"æ—¥å¸¸ç”Ÿæ´»ã€å®¶åº­ã€ç”Ÿæ´»çäº‹"},{name:"ç¤¾äº¤",icon:"ğŸ‘¥",description:"æœ‹å‹èšä¼šã€ç¤¾äº¤æ´»åŠ¨"},{name:"å¥åº·",icon:"ğŸ’Š",description:"èº«ä½“å¥åº·ã€åŒ»ç–—ç›¸å…³"},{name:"å…¶ä»–",icon:"ğŸŒŸ",description:"å…¶ä»–ç‰¹æ®Šæƒ…å†µ"}]),r=e.ref(["å·¥ä½œå‹åŠ›","äººé™…å…³ç³»","èº«ä½“ä¸é€‚","ç»æµé—®é¢˜","å­¦ä¹ å›°éš¾","å®¶åº­çŸ›ç›¾","ç¯å¢ƒå˜åŒ–","æ—¶é—´å‹åŠ›","æœŸæœ›è½ç©º","æ²Ÿé€šé—®é¢˜","å†³ç­–å›°éš¾","å…¶ä»–"]),d=e.ref(["å¿ƒè·³åŠ é€Ÿ","èƒ¸é—·æ°”çŸ­","è‚Œè‚‰ç´§å¼ ","å¤´ç—›å¤´æ™•","å¤±çœ å¤šæ¢¦","é£Ÿæ¬²å˜åŒ–","ç–²åŠ³ä¹åŠ›","å‡ºæ±—é¢¤æŠ–","èƒƒéƒ¨ä¸é€‚","æ³¨æ„åŠ›éš¾é›†ä¸­","æ— æ˜æ˜¾ç—‡çŠ¶"]),p=e.ref(["æ·±å‘¼å¸","è¿åŠ¨é”»ç‚¼","å¬éŸ³ä¹","å€¾è¯‰äº¤æµ","å†™æ—¥è®°","å†¥æƒ³æ”¾æ¾","è½¬ç§»æ³¨æ„åŠ›","å¯»æ±‚å¸®åŠ©","ç§¯ææ€è€ƒ","æ¥å—ç°çŠ¶","æš‚æ—¶å›é¿","å…¶ä»–æ–¹å¼"]),u=e.ref([{question:"è¿™ç§æƒ…ç»ªè®©ä½ èº«ä½“æœ‰ä»€ä¹ˆååº”ï¼Ÿ",options:["å¿ƒè·³åŠ é€Ÿ","èƒ¸é—·æ°”çŸ­","è‚Œè‚‰ç´§å¼ ","å¤´ç—›å¤´æ™•","æ²¡æœ‰æ˜æ˜¾ååº”"]},{question:"ä½ è®¤ä¸ºè¿™ç§æƒ…ç»ªä¸»è¦ç”±ä»€ä¹ˆå¼•èµ·ï¼Ÿ",options:["å…·ä½“äº‹ä»¶","èº«ä½“çŠ¶æ€","ä»–äººè¡Œä¸º","ç¯å¢ƒå› ç´ ","æ— æ˜æ˜¾åŸå› "]},{question:"é¢å¯¹è¿™ç§æƒ…ç»ªï¼Œä½ é€šå¸¸ä¼šï¼Ÿ",options:["åˆ†æé—®é¢˜","å¯»æ±‚å¸®åŠ©","æš‚æ—¶å›é¿","è‡ªæˆ‘å¦å®š","æ¥å—ç°çŠ¶"]},{question:"è¿™ç§æƒ…ç»ªå¯¹ä½ çš„å½±å“ç¨‹åº¦ï¼Ÿ",options:["ä¸¥é‡å½±å“æ—¥å¸¸","ä¸­ç­‰å½±å“","è½»å¾®å½±å“","åŸºæœ¬æ— å½±å“"]},{question:"ä½ å¸Œæœ›é€šè¿‡ä»€ä¹ˆæ–¹å¼æ”¹å–„ï¼Ÿ",options:["è¿åŠ¨é”»ç‚¼","å€¾è¯‰äº¤æµ","ä¸“ä¸šå¸®åŠ©","è‡ªæˆ‘è°ƒèŠ‚","æš‚æ—¶ä¸å¤„ç†"]}]),m=e=>{a.text=e.detail.value},g=e=>{a.intensity=e.detail.value},v=e=>{a.enableDeepAnalysis=e.detail.value},h=()=>{o.value<4&&o.value++},y=()=>{o.value>1&&o.value--},x=()=>{a.enableDeepAnalysis=!a.enableDeepAnalysis},f=()=>{e.index.showToast({title:"è¯­éŸ³è¾“å…¥åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},w=()=>{a.enableDeepAnalysis?(a.deepAnswers=new Array(u.value.length).fill(void 0),i.value=!0,s.value=0):b()},A=()=>{s.value<u.value.length-1?s.value++:(_(),b())},S=()=>{s.value>0&&s.value--},_=()=>{i.value=!1},b=async()=>{if(!n.getToken())return e.index.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}),void e.index.navigateTo({url:"/pages/login/index"});if(a.text.trim())if(0!==a.emotions.length)if(a.scene)try{e.index.showLoading({title:"ä¿å­˜ä¸­..."});const t={emotion_type:T(a.emotions[0]),intensity:a.intensity,scenario:M(a.scene),description:a.text,triggers:a.triggers.length>0?a.triggers:["æ‰‹åŠ¨è®°å½•"],physical_symptoms:a.physicalSymptoms.length>0?a.physicalSymptoms:[],coping_methods:a.copingMethods.length>0?a.copingMethods:["æƒ…ç»ªè®°å½•"],people_involved:[],location:"",weather:"",effectiveness_rating:null,is_private:!1,enable_ai_analysis:a.enableDeepAnalysis};if(a.enableDeepAnalysis&&a.deepAnswers.length>0){const e=u.value.map((e,n)=>void 0!==a.deepAnswers[n]?`${e.question}: ${e.options[a.deepAnswers[n]]}`:null).filter(e=>Boolean(e));t.triggers=[...t.triggers,...e]}console.log("æäº¤è®°å½•æ•°æ®:",t);const o=await n.emotionAPI.createRecord(t);e.index.hideLoading(),e.index.showToast({title:"è®°å½•ä¿å­˜æˆåŠŸ",icon:"success"}),j(),D(),setTimeout(()=>{a.enableDeepAnalysis?e.index.navigateTo({url:`/pages/analysis/index?recordId=${o.id}`}):e.index.switchTab({url:"/pages/index/index"})},1500)}catch(t){e.index.hideLoading(),console.error("ä¿å­˜è®°å½•å¤±è´¥:",t),e.index.showToast({title:(null==t?void 0:t.message)||"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:3e3})}else e.index.showToast({title:"è¯·é€‰æ‹©ç›¸å…³åœºæ™¯",icon:"none"});else e.index.showToast({title:"è¯·é€‰æ‹©è‡³å°‘ä¸€ç§æƒ…ç»ª",icon:"none"});else e.index.showToast({title:"è¯·è¾“å…¥æƒ…ç»ªæè¿°",icon:"none"})},D=()=>{a.text="",a.emotions=[],a.intensity=5,a.scene="",a.triggers=[],a.physicalSymptoms=[],a.copingMethods=[],a.enableDeepAnalysis=!1,a.deepAnswers=[],o.value=1,i.value=!1,s.value=0},T=e=>({"å¿«ä¹":"happy","ç„¦è™‘":"anxious","æ„¤æ€’":"angry","æ‚²ä¼¤":"sad","å¹³é™":"calm","ææƒ§":"fearful"}[e]||"happy"),M=e=>({"å·¥ä½œ":"work","å­¦ä¹ ":"study","ç”Ÿæ´»":"personal","ç¤¾äº¤":"social","å¥åº·":"health","å…¶ä»–":"other"}[e]||"personal"),q=()=>{const n={...a,currentStep:o.value,timestamp:Date.now()};e.index.setStorageSync("emotion_record_draft",n),e.index.showToast({title:"è‰ç¨¿å·²ä¿å­˜",icon:"success",duration:1500})},j=()=>{e.index.removeStorageSync("emotion_record_draft")};return e.onMounted(()=>{const n=getCurrentPages(),t=n[n.length-1],i=(null==t?void 0:t.options)||{};i.quickEmotion?(a.emotions=[i.quickEmotion],o.value=2):(()=>{try{const n=e.index.getStorageSync("emotion_record_draft");if(n&&n.timestamp){Date.now()-n.timestamp<864e5?e.index.showModal({title:"å‘ç°è‰ç¨¿",content:"æ£€æµ‹åˆ°æœªå®Œæˆçš„è®°å½•ï¼Œæ˜¯å¦ç»§ç»­ç¼–è¾‘ï¼Ÿ",success:t=>{t.confirm?(Object.assign(a,n),o.value=n.currentStep||1,e.index.showToast({title:"è‰ç¨¿å·²æ¢å¤",icon:"success"})):e.index.removeStorageSync("emotion_record_draft")}}):e.index.removeStorageSync("emotion_record_draft")}}catch(n){console.log("åŠ è½½è‰ç¨¿å¤±è´¥:",n)}})()}),(n,t)=>e.e({a:e.o(q),b:o.value>=1?1:"",c:o.value>=2?1:"",d:o.value>=2?1:"",e:o.value>=3?1:"",f:o.value>=3?1:"",g:o.value>=4?1:"",h:o.value>=4?1:"",i:1===o.value},1===o.value?{j:e.o([e=>a.text=e.detail.value,m]),k:a.text,l:e.t(a.text.length),m:e.o(f),n:e.o(h),o:!a.text.trim()}:{},{p:2===o.value},2===o.value?e.e({q:e.f(l.value,(n,t,o)=>({a:e.t(n.icon),b:e.t(n.name),c:e.t(n.description),d:n.name,e:a.emotions.includes(n.name)?1:"",f:e.o(e=>(e=>{const n=a.emotions.indexOf(e);n>-1?a.emotions.splice(n,1):a.emotions.push(e)})(n.name),n.name)})),r:a.emotions.length>0},a.emotions.length>0?{s:e.t(a.intensity),t:a.intensity,v:e.o(g)}:{},{w:e.o(y),x:e.o(h),y:0===a.emotions.length}):{},{z:3===o.value},3===o.value?{A:e.f(c.value,(n,t,o)=>e.e({a:e.t(n.icon),b:e.t(n.name),c:e.t(n.description),d:a.scene===n.name},(a.scene,n.name,{}),{e:n.name,f:a.scene===n.name?1:"",g:e.o(e=>{return t=n.name,void(a.scene=t);var t},n.name)})),B:a.enableDeepAnalysis,C:e.o(v),D:e.o(x),E:e.o(y),F:e.o(h),G:!a.scene}:{},{H:4===o.value},4===o.value?e.e({I:e.f(r.value,(n,t,o)=>({a:e.t(n),b:n,c:a.triggers.includes(n)?1:"",d:e.o(e=>(e=>{const n=a.triggers.indexOf(e);n>-1?a.triggers.splice(n,1):a.triggers.push(e)})(n),n)})),J:e.f(d.value,(n,t,o)=>({a:e.t(n),b:n,c:a.physicalSymptoms.includes(n)?1:"",d:e.o(e=>(e=>{const n=a.physicalSymptoms.indexOf(e);n>-1?a.physicalSymptoms.splice(n,1):a.physicalSymptoms.push(e)})(n),n)})),K:e.f(p.value,(n,t,o)=>({a:e.t(n),b:n,c:a.copingMethods.includes(n)?1:"",d:e.o(e=>(e=>{const n=a.copingMethods.indexOf(e);n>-1?a.copingMethods.splice(n,1):a.copingMethods.push(e)})(n),n)})),L:a.enableDeepAnalysis,M:e.o(v),N:e.o(x),O:e.t(a.text||"æš‚æ— "),P:e.t(a.emotions.join("ã€")||"æš‚æ— "),Q:e.t(a.intensity),R:e.t(a.scene||"æš‚æ— "),S:a.triggers.length>0},a.triggers.length>0?{T:e.t(a.triggers.join("ã€"))}:{},{U:a.physicalSymptoms.length>0},a.physicalSymptoms.length>0?{V:e.t(a.physicalSymptoms.join("ã€"))}:{},{W:a.copingMethods.length>0},a.copingMethods.length>0?{X:e.t(a.copingMethods.join("ã€"))}:{},{Y:e.o(y),Z:e.t(a.enableDeepAnalysis?"ç»§ç»­æ·±åº¦åˆ†æ":"ä¿å­˜è®°å½•"),aa:e.o(w)}):{},{ab:i.value},i.value?e.e({ac:e.t(s.value+1),ad:e.t(u.value.length),ae:e.o(_),af:e.t(u.value[s.value].question),ag:e.f(u.value[s.value].options,(n,t,o)=>({a:e.t(n),b:t,c:a.deepAnswers[s.value]===t?1:"",d:e.o(e=>{return n=t,void(a.deepAnswers[s.value]=n);var n},t)})),ah:s.value>0},s.value>0?{ai:e.o(S)}:{},{aj:e.t(s.value===u.value.length-1?"å®Œæˆåˆ†æ":"ä¸‹ä¸€é¢˜"),ak:e.o(A),al:void 0===a.deepAnswers[s.value]}):{})}}),o=e._export_sfc(t,[["__scopeId","data-v-de8e6dd4"]]);wx.createPage(o);
