import{g as e,r as a,h as t,j as s,o as l,c as n,w as i,b as u,a as c,d as r,t as d,u as o,l as f,m as _,F as g,e as v,i as m,B as y,f as h,n as p,k as w}from"./index-6afd3b48.js";import{d as x}from"./api.ae518a48.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";const b=k(e({__name:"history",setup(e){const k=a([]),b=a(!1),D=a(!0),T=a(1),C=a(0),$=a(0),I=a(["全部时间","最近一周","最近一月","最近三月"]),j=a(["按时间排序","按评分排序","按置信度排序"]),A=t(()=>k.value.length),S=t(()=>{if(0===k.value.length)return"0.0";return(k.value.reduce((e,a)=>e+(a.user_rating||0),0)/k.value.length).toFixed(1)}),M=t(()=>{let e=[...k.value];const a=new Date;switch(C.value){case 1:const t=new Date(a.getTime()-6048e5);e=e.filter(e=>new Date(e.created_at)>=t);break;case 2:const s=new Date(a.getTime()-2592e6);e=e.filter(e=>new Date(e.created_at)>=s);break;case 3:const l=new Date(a.getTime()-7776e6);e=e.filter(e=>new Date(e.created_at)>=l)}switch($.value){case 0:e.sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime());break;case 1:e.sort((e,a)=>(a.user_rating||0)-(e.user_rating||0));break;case 2:e.sort((e,a)=>a.confidence_score-e.confidence_score)}return e}),F=async(e=1)=>{try{b.value=!0;const a=await x.getAnalysisHistory({page:e,page_size:10});1===e?k.value=a.results||[]:k.value.push(...a.results||[]),D.value=!!a.next,T.value=e}catch(a){console.error("加载分析历史失败:",a),uni.showToast({title:"加载失败，请重试",icon:"none"})}finally{b.value=!1}},H=()=>{D.value&&!b.value&&F(T.value+1)},z=e=>{C.value=e.detail.value},B=e=>{$.value=e.detail.value},q=e=>{const a=new Date(e),t=(new Date).getTime()-a.getTime(),s=Math.floor(t/864e5);if(0===s)return"今天";if(1===s)return"昨天";if(s<7)return`${s}天前`;return`${a.getMonth()+1}月${a.getDate()}日`},E=e=>{const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},G=e=>e>=80?"高置信度":e>=60?"中置信度":"低置信度",J=()=>{uni.switchTab({url:"/pages/record/index"})};return s(()=>{F()}),(e,a)=>{const t=v,s=m,x=y,k=h;return l(),n(s,{class:"container"},{default:i(()=>[u(" 页面头部 "),c(s,{class:"page-header"},{default:i(()=>[c(s,{class:"header-content"},{default:i(()=>[c(t,{class:"page-title"},{default:i(()=>[r("分析历史")]),_:1}),c(t,{class:"page-subtitle"},{default:i(()=>[r("回顾你的情绪分析历程")]),_:1})]),_:1}),c(s,{class:"header-stats"},{default:i(()=>[c(s,{class:"stat-item"},{default:i(()=>[c(t,{class:"stat-number"},{default:i(()=>[r(d(o(A)),1)]),_:1}),c(t,{class:"stat-label"},{default:i(()=>[r("总分析数")]),_:1})]),_:1}),c(s,{class:"stat-item"},{default:i(()=>[c(t,{class:"stat-number"},{default:i(()=>[r(d(o(S)),1)]),_:1}),c(t,{class:"stat-label"},{default:i(()=>[r("平均评分")]),_:1})]),_:1})]),_:1})]),_:1}),u(" 筛选和排序 "),c(s,{class:"filter-section glass-card"},{default:i(()=>[c(s,{class:"filter-row"},{default:i(()=>[c(x,{range:I.value,value:C.value,onChange:z},{default:i(()=>[c(s,{class:"filter-item"},{default:i(()=>[c(t,{class:"filter-icon"},{default:i(()=>[r("📅")]),_:1}),c(t,{class:"filter-text"},{default:i(()=>[r(d(I.value[C.value]),1)]),_:1}),c(t,{class:"filter-arrow"},{default:i(()=>[r("▼")]),_:1})]),_:1})]),_:1},8,["range","value"]),c(x,{range:j.value,value:$.value,onChange:B},{default:i(()=>[c(s,{class:"filter-item"},{default:i(()=>[c(t,{class:"filter-icon"},{default:i(()=>[r("🔄")]),_:1}),c(t,{class:"filter-text"},{default:i(()=>[r(d(j.value[$.value]),1)]),_:1}),c(t,{class:"filter-arrow"},{default:i(()=>[r("▼")]),_:1})]),_:1})]),_:1},8,["range","value"])]),_:1})]),_:1}),u(" 分析历史列表 "),c(s,{class:"history-list"},{default:i(()=>[(l(!0),f(g,null,_(o(M),e=>(l(),n(s,{class:"history-item glass-card",key:e.id,onClick:a=>(e=>{uni.navigateTo({url:`/pages/analysis/index?analysisId=${e.id}`})})(e)},{default:i(()=>[u(" 分析头部信息 "),c(s,{class:"analysis-header"},{default:i(()=>[c(s,{class:"analysis-date"},{default:i(()=>[c(t,{class:"date-text"},{default:i(()=>[r(d(q(e.created_at)),1)]),_:2},1024),c(t,{class:"time-text"},{default:i(()=>[r(d(E(e.created_at)),1)]),_:2},1024)]),_:2},1024),c(s,{class:"analysis-status"},{default:i(()=>{return[c(s,{class:p(["status-badge",(a=e.confidence_score,a>=80?"status-high":a>=60?"status-medium":"status-low")])},{default:i(()=>[c(t,{class:"status-text"},{default:i(()=>[r(d(G(e.confidence_score)),1)]),_:2},1024)]),_:2},1032,["class"])];var a}),_:2},1024)]),_:2},1024),u(" 情绪信息 "),c(s,{class:"emotion-info"},{default:i(()=>[c(s,{class:"primary-emotion"},{default:i(()=>[c(t,{class:"emotion-icon"},{default:i(()=>{return[r(d((a=e.primary_emotion,{happy:"😊",sad:"😢",angry:"😠",anxious:"😰",excited:"🤩",calm:"😌",confused:"😕"}[a]||"😐")),1)];var a}),_:2},1024),c(t,{class:"emotion-name"},{default:i(()=>{return[r(d((a=e.primary_emotion,{happy:"快乐",sad:"悲伤",angry:"愤怒",anxious:"焦虑",excited:"兴奋",calm:"平静",confused:"困惑"}[a]||"未知")),1)];var a}),_:2},1024),c(s,{class:"intensity-bar"},{default:i(()=>[c(s,{class:"intensity-fill",style:w({width:10*e.intensity_level+"%"})},null,8,["style"])]),_:2},1024),c(t,{class:"intensity-text"},{default:i(()=>[r(d(e.intensity_level)+"/10",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),u(" AI洞察预览 "),c(s,{class:"insights-preview"},{default:i(()=>[c(t,{class:"insights-title"},{default:i(()=>[r("AI洞察")]),_:1}),c(t,{class:"insights-summary"},{default:i(()=>{var a;return[r(d((null==(a=e.key_insights[0])?void 0:a.content)||"暂无洞察"),1)]}),_:2},1024),e.key_insights.length>1?(l(),n(s,{key:0,class:"insights-count"},{default:i(()=>[c(t,{class:"count-text"},{default:i(()=>[r("+"+d(e.key_insights.length-1)+"个洞察",1)]),_:2},1024)]),_:2},1024)):u("v-if",!0)]),_:2},1024),u(" 建议预览 "),e.suggestions.length>0?(l(),n(s,{key:0,class:"suggestions-preview"},{default:i(()=>[c(t,{class:"suggestions-title"},{default:i(()=>[r("个性化建议")]),_:1}),c(s,{class:"suggestion-tags"},{default:i(()=>[(l(!0),f(g,null,_(e.suggestions.slice(0,3),(e,a)=>(l(),n(s,{class:"suggestion-tag",key:a},{default:i(()=>[c(t,{class:"tag-text"},{default:i(()=>[r(d(e.title),1)]),_:2},1024)]),_:2},1024))),128)),e.suggestions.length>3?(l(),n(s,{key:0,class:"more-suggestions"},{default:i(()=>[c(t,{class:"more-text"},{default:i(()=>[r("+"+d(e.suggestions.length-3),1)]),_:2},1024)]),_:2},1024)):u("v-if",!0)]),_:2},1024)]),_:2},1024)):u("v-if",!0),u(" 分析评分 "),c(s,{class:"analysis-footer"},{default:i(()=>[c(s,{class:"confidence-score"},{default:i(()=>[c(t,{class:"score-label"},{default:i(()=>[r("置信度")]),_:1}),c(s,{class:"score-bar"},{default:i(()=>[c(s,{class:"score-fill",style:w({width:e.confidence_score+"%"})},null,8,["style"])]),_:2},1024),c(t,{class:"score-text"},{default:i(()=>[r(d(e.confidence_score)+"%",1)]),_:2},1024)]),_:2},1024),c(s,{class:"view-detail"},{default:i(()=>[c(t,{class:"detail-text"},{default:i(()=>[r("查看详情")]),_:1}),c(t,{class:"detail-arrow"},{default:i(()=>[r("→")]),_:1})]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),u(" 加载状态 "),b.value?(l(),n(s,{key:0,class:"loading-section"},{default:i(()=>[c(s,{class:"loading-spinner"}),c(t,{class:"loading-text"},{default:i(()=>[r("加载中...")]),_:1})]),_:1})):u("v-if",!0),u(" 空状态 "),b.value||0!==o(M).length?u("v-if",!0):(l(),n(s,{key:1,class:"empty-state"},{default:i(()=>[c(t,{class:"empty-icon"},{default:i(()=>[r("📊")]),_:1}),c(t,{class:"empty-title"},{default:i(()=>[r("暂无分析记录")]),_:1}),c(t,{class:"empty-desc"},{default:i(()=>[r("开始记录情绪，获得AI分析建议")]),_:1}),c(k,{class:"start-record-btn",onClick:J},{default:i(()=>[r(" 开始记录 ")]),_:1})]),_:1})),u(" 加载更多 "),D.value&&!b.value?(l(),n(s,{key:2,class:"load-more"},{default:i(()=>[c(k,{class:"load-more-btn",onClick:H},{default:i(()=>[r(" 加载更多 ")]),_:1})]),_:1})):u("v-if",!0)]),_:1})}}}),[["__scopeId","data-v-05b71762"]]);export{b as default};
