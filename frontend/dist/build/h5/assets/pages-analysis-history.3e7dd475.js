import{g as e,r as a,h as t,j as s,o as l,c as n,w as i,b as u,a as c,d as r,t as d,u as o,l as f,m as _,F as g,e as v,i as m,B as y,f as h,n as p,k as w}from"./index-6afd3b48.js";import{d as x}from"./api.ae518a48.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";const b=k(e({__name:"history",setup(e){const k=a([]),b=a(!1),D=a(!0),T=a(1),C=a(0),$=a(0),I=a(["å…¨éƒ¨æ—¶é—´","æœ€è¿‘ä¸€å‘¨","æœ€è¿‘ä¸€æœˆ","æœ€è¿‘ä¸‰æœˆ"]),j=a(["æŒ‰æ—¶é—´æŽ’åº","æŒ‰è¯„åˆ†æŽ’åº","æŒ‰ç½®ä¿¡åº¦æŽ’åº"]),A=t(()=>k.value.length),S=t(()=>{if(0===k.value.length)return"0.0";return(k.value.reduce((e,a)=>e+(a.user_rating||0),0)/k.value.length).toFixed(1)}),M=t(()=>{let e=[...k.value];const a=new Date;switch(C.value){case 1:const t=new Date(a.getTime()-6048e5);e=e.filter(e=>new Date(e.created_at)>=t);break;case 2:const s=new Date(a.getTime()-2592e6);e=e.filter(e=>new Date(e.created_at)>=s);break;case 3:const l=new Date(a.getTime()-7776e6);e=e.filter(e=>new Date(e.created_at)>=l)}switch($.value){case 0:e.sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime());break;case 1:e.sort((e,a)=>(a.user_rating||0)-(e.user_rating||0));break;case 2:e.sort((e,a)=>a.confidence_score-e.confidence_score)}return e}),F=async(e=1)=>{try{b.value=!0;const a=await x.getAnalysisHistory({page:e,page_size:10});1===e?k.value=a.results||[]:k.value.push(...a.results||[]),D.value=!!a.next,T.value=e}catch(a){console.error("åŠ è½½åˆ†æžåŽ†å²å¤±è´¥:",a),uni.showToast({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}finally{b.value=!1}},H=()=>{D.value&&!b.value&&F(T.value+1)},z=e=>{C.value=e.detail.value},B=e=>{$.value=e.detail.value},q=e=>{const a=new Date(e),t=(new Date).getTime()-a.getTime(),s=Math.floor(t/864e5);if(0===s)return"ä»Šå¤©";if(1===s)return"æ˜¨å¤©";if(s<7)return`${s}å¤©å‰`;return`${a.getMonth()+1}æœˆ${a.getDate()}æ—¥`},E=e=>{const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},G=e=>e>=80?"é«˜ç½®ä¿¡åº¦":e>=60?"ä¸­ç½®ä¿¡åº¦":"ä½Žç½®ä¿¡åº¦",J=()=>{uni.switchTab({url:"/pages/record/index"})};return s(()=>{F()}),(e,a)=>{const t=v,s=m,x=y,k=h;return l(),n(s,{class:"container"},{default:i(()=>[u(" é¡µé¢å¤´éƒ¨ "),c(s,{class:"page-header"},{default:i(()=>[c(s,{class:"header-content"},{default:i(()=>[c(t,{class:"page-title"},{default:i(()=>[r("åˆ†æžåŽ†å²")]),_:1}),c(t,{class:"page-subtitle"},{default:i(()=>[r("å›žé¡¾ä½ çš„æƒ…ç»ªåˆ†æžåŽ†ç¨‹")]),_:1})]),_:1}),c(s,{class:"header-stats"},{default:i(()=>[c(s,{class:"stat-item"},{default:i(()=>[c(t,{class:"stat-number"},{default:i(()=>[r(d(o(A)),1)]),_:1}),c(t,{class:"stat-label"},{default:i(()=>[r("æ€»åˆ†æžæ•°")]),_:1})]),_:1}),c(s,{class:"stat-item"},{default:i(()=>[c(t,{class:"stat-number"},{default:i(()=>[r(d(o(S)),1)]),_:1}),c(t,{class:"stat-label"},{default:i(()=>[r("å¹³å‡è¯„åˆ†")]),_:1})]),_:1})]),_:1})]),_:1}),u(" ç­›é€‰å’ŒæŽ’åº "),c(s,{class:"filter-section glass-card"},{default:i(()=>[c(s,{class:"filter-row"},{default:i(()=>[c(x,{range:I.value,value:C.value,onChange:z},{default:i(()=>[c(s,{class:"filter-item"},{default:i(()=>[c(t,{class:"filter-icon"},{default:i(()=>[r("ðŸ“…")]),_:1}),c(t,{class:"filter-text"},{default:i(()=>[r(d(I.value[C.value]),1)]),_:1}),c(t,{class:"filter-arrow"},{default:i(()=>[r("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value"]),c(x,{range:j.value,value:$.value,onChange:B},{default:i(()=>[c(s,{class:"filter-item"},{default:i(()=>[c(t,{class:"filter-icon"},{default:i(()=>[r("ðŸ”„")]),_:1}),c(t,{class:"filter-text"},{default:i(()=>[r(d(j.value[$.value]),1)]),_:1}),c(t,{class:"filter-arrow"},{default:i(()=>[r("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value"])]),_:1})]),_:1}),u(" åˆ†æžåŽ†å²åˆ—è¡¨ "),c(s,{class:"history-list"},{default:i(()=>[(l(!0),f(g,null,_(o(M),e=>(l(),n(s,{class:"history-item glass-card",key:e.id,onClick:a=>(e=>{uni.navigateTo({url:`/pages/analysis/index?analysisId=${e.id}`})})(e)},{default:i(()=>[u(" åˆ†æžå¤´éƒ¨ä¿¡æ¯ "),c(s,{class:"analysis-header"},{default:i(()=>[c(s,{class:"analysis-date"},{default:i(()=>[c(t,{class:"date-text"},{default:i(()=>[r(d(q(e.created_at)),1)]),_:2},1024),c(t,{class:"time-text"},{default:i(()=>[r(d(E(e.created_at)),1)]),_:2},1024)]),_:2},1024),c(s,{class:"analysis-status"},{default:i(()=>{return[c(s,{class:p(["status-badge",(a=e.confidence_score,a>=80?"status-high":a>=60?"status-medium":"status-low")])},{default:i(()=>[c(t,{class:"status-text"},{default:i(()=>[r(d(G(e.confidence_score)),1)]),_:2},1024)]),_:2},1032,["class"])];var a}),_:2},1024)]),_:2},1024),u(" æƒ…ç»ªä¿¡æ¯ "),c(s,{class:"emotion-info"},{default:i(()=>[c(s,{class:"primary-emotion"},{default:i(()=>[c(t,{class:"emotion-icon"},{default:i(()=>{return[r(d((a=e.primary_emotion,{happy:"ðŸ˜Š",sad:"ðŸ˜¢",angry:"ðŸ˜ ",anxious:"ðŸ˜°",excited:"ðŸ¤©",calm:"ðŸ˜Œ",confused:"ðŸ˜•"}[a]||"ðŸ˜")),1)];var a}),_:2},1024),c(t,{class:"emotion-name"},{default:i(()=>{return[r(d((a=e.primary_emotion,{happy:"å¿«ä¹",sad:"æ‚²ä¼¤",angry:"æ„¤æ€’",anxious:"ç„¦è™‘",excited:"å…´å¥‹",calm:"å¹³é™",confused:"å›°æƒ‘"}[a]||"æœªçŸ¥")),1)];var a}),_:2},1024),c(s,{class:"intensity-bar"},{default:i(()=>[c(s,{class:"intensity-fill",style:w({width:10*e.intensity_level+"%"})},null,8,["style"])]),_:2},1024),c(t,{class:"intensity-text"},{default:i(()=>[r(d(e.intensity_level)+"/10",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),u(" AIæ´žå¯Ÿé¢„è§ˆ "),c(s,{class:"insights-preview"},{default:i(()=>[c(t,{class:"insights-title"},{default:i(()=>[r("AIæ´žå¯Ÿ")]),_:1}),c(t,{class:"insights-summary"},{default:i(()=>{var a;return[r(d((null==(a=e.key_insights[0])?void 0:a.content)||"æš‚æ— æ´žå¯Ÿ"),1)]}),_:2},1024),e.key_insights.length>1?(l(),n(s,{key:0,class:"insights-count"},{default:i(()=>[c(t,{class:"count-text"},{default:i(()=>[r("+"+d(e.key_insights.length-1)+"ä¸ªæ´žå¯Ÿ",1)]),_:2},1024)]),_:2},1024)):u("v-if",!0)]),_:2},1024),u(" å»ºè®®é¢„è§ˆ "),e.suggestions.length>0?(l(),n(s,{key:0,class:"suggestions-preview"},{default:i(()=>[c(t,{class:"suggestions-title"},{default:i(()=>[r("ä¸ªæ€§åŒ–å»ºè®®")]),_:1}),c(s,{class:"suggestion-tags"},{default:i(()=>[(l(!0),f(g,null,_(e.suggestions.slice(0,3),(e,a)=>(l(),n(s,{class:"suggestion-tag",key:a},{default:i(()=>[c(t,{class:"tag-text"},{default:i(()=>[r(d(e.title),1)]),_:2},1024)]),_:2},1024))),128)),e.suggestions.length>3?(l(),n(s,{key:0,class:"more-suggestions"},{default:i(()=>[c(t,{class:"more-text"},{default:i(()=>[r("+"+d(e.suggestions.length-3),1)]),_:2},1024)]),_:2},1024)):u("v-if",!0)]),_:2},1024)]),_:2},1024)):u("v-if",!0),u(" åˆ†æžè¯„åˆ† "),c(s,{class:"analysis-footer"},{default:i(()=>[c(s,{class:"confidence-score"},{default:i(()=>[c(t,{class:"score-label"},{default:i(()=>[r("ç½®ä¿¡åº¦")]),_:1}),c(s,{class:"score-bar"},{default:i(()=>[c(s,{class:"score-fill",style:w({width:e.confidence_score+"%"})},null,8,["style"])]),_:2},1024),c(t,{class:"score-text"},{default:i(()=>[r(d(e.confidence_score)+"%",1)]),_:2},1024)]),_:2},1024),c(s,{class:"view-detail"},{default:i(()=>[c(t,{class:"detail-text"},{default:i(()=>[r("æŸ¥çœ‹è¯¦æƒ…")]),_:1}),c(t,{class:"detail-arrow"},{default:i(()=>[r("â†’")]),_:1})]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),u(" åŠ è½½çŠ¶æ€ "),b.value?(l(),n(s,{key:0,class:"loading-section"},{default:i(()=>[c(s,{class:"loading-spinner"}),c(t,{class:"loading-text"},{default:i(()=>[r("åŠ è½½ä¸­...")]),_:1})]),_:1})):u("v-if",!0),u(" ç©ºçŠ¶æ€ "),b.value||0!==o(M).length?u("v-if",!0):(l(),n(s,{key:1,class:"empty-state"},{default:i(()=>[c(t,{class:"empty-icon"},{default:i(()=>[r("ðŸ“Š")]),_:1}),c(t,{class:"empty-title"},{default:i(()=>[r("æš‚æ— åˆ†æžè®°å½•")]),_:1}),c(t,{class:"empty-desc"},{default:i(()=>[r("å¼€å§‹è®°å½•æƒ…ç»ªï¼ŒèŽ·å¾—AIåˆ†æžå»ºè®®")]),_:1}),c(k,{class:"start-record-btn",onClick:J},{default:i(()=>[r(" å¼€å§‹è®°å½• ")]),_:1})]),_:1})),u(" åŠ è½½æ›´å¤š "),D.value&&!b.value?(l(),n(s,{key:2,class:"load-more"},{default:i(()=>[c(k,{class:"load-more-btn",onClick:H},{default:i(()=>[r(" åŠ è½½æ›´å¤š ")]),_:1})]),_:1})):u("v-if",!0)]),_:1})}}}),[["__scopeId","data-v-05b71762"]]);export{b as default};
