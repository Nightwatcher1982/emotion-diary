import{g as e,r as a,h as t,j as s,o as l,c as n,w as i,b as o,a as c,d as u,t as d,u as r,k as m,l as f,m as _,F as p,i as g,e as y,n as v}from"./index-cc15a06a.js";import{g as h,c as w,e as k}from"./api.ce5d8515.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";const b=x(e({__name:"index",setup(e){const x=a("小明"),b=a(null),T=a([]),C=a(!0),$=a(null),D=a({icon:"☀️",desc:"晴朗"}),j=a([{name:"快乐",icon:"😄",type:"happy"},{name:"平静",icon:"😌",type:"calm"},{name:"焦虑",icon:"😟",type:"anxious"},{name:"悲伤",icon:"😢",type:"sad"},{name:"愤怒",icon:"😡",type:"angry"},{name:"恐惧",icon:"😨",type:"fearful"}]),R=t(()=>{const e=(new Date).getHours();return e<6?"夜深了":e<12?"早上好":e<18?"下午好":"晚上好"}),S=t(()=>{const e=(new Date).getHours();return e<6?"🌙":e<12?"🌅":e<18?"☀️":"🌆"}),H=t(()=>{const e=new Date;return`${e.getMonth()+1}月${e.getDate()}日 星期${["日","一","二","三","四","五","六"][e.getDay()]}`}),L=()=>{uni.switchTab({url:"/pages/record/index"})},I=()=>{uni.switchTab({url:"/pages/statistics/index"})},M=e=>{const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},q=async()=>{C.value=!0;try{const[e,a]=await Promise.all([k.getTodayRecords(),k.getRecentRecords()]);if(e&&e.length>0){const a=e[0];b.value={name:z(a.emotion_type),icon:F(a.emotion_type),intensity:a.intensity,scene:P(a.scenario),time:M(a.emotion_time)}}else b.value=null;T.value=a.slice(0,3).map(e=>({id:e.id,emotion:F(e.emotion_type),name:z(e.emotion_type),time:M(e.emotion_time),content:e.description.length>30?e.description.substring(0,30)+"...":e.description}))}catch(e){console.error("加载数据失败:",e),uni.showToast({title:"数据加载失败",icon:"none"}),"Unauthorized"===(null==e?void 0:e.message)&&uni.navigateTo({url:"/pages/login/index"})}finally{C.value=!1}},z=e=>({happy:"快乐",sad:"悲伤",angry:"愤怒",anxious:"焦虑",calm:"平静",fearful:"恐惧",excited:"兴奋",frustrated:"沮丧",grateful:"感激",lonely:"孤独",confident:"自信",overwhelmed:"不知所措"}[e]||e),F=e=>({happy:"😊",sad:"😢",angry:"😠",anxious:"😰",calm:"😌",fearful:"😨",excited:"🤩",frustrated:"😤",grateful:"🙏",lonely:"😔",confident:"😎",overwhelmed:"🤯"}[e]||"😊"),P=e=>({work:"工作",study:"学习",family:"家庭",social:"社交",health:"健康",finance:"财务",relationship:"感情",personal:"个人",entertainment:"娱乐",travel:"旅行",other:"其他"}[e]||e);return s(()=>{(async()=>{h()?($.value=w(),$.value&&(x.value=$.value.nickname||$.value.username),await q()):uni.navigateTo({url:"/pages/login/index"})})()}),(e,a)=>{const t=g,s=y;return l(),n(t,{class:"container"},{default:i(()=>[o(" 顶部欢迎区域 "),c(t,{class:"welcome-section"},{default:i(()=>[c(t,{class:"welcome-background"}),c(t,{class:"welcome-content"},{default:i(()=>[c(t,{class:"greeting"},{default:i(()=>[c(s,{class:"greeting-text"},{default:i(()=>[u(d(r(R))+"，",1)]),_:1}),c(s,{class:"username"},{default:i(()=>[u(d(x.value||"用户"),1)]),_:1}),c(s,{class:"greeting-emoji"},{default:i(()=>[u(d(r(S)),1)]),_:1})]),_:1}),c(t,{class:"date-info"},{default:i(()=>[c(s,{class:"date"},{default:i(()=>[u(d(r(H)),1)]),_:1}),D.value?(l(),n(t,{key:0,class:"weather-info"},{default:i(()=>[c(s,{class:"weather-icon"},{default:i(()=>[u(d(D.value.icon),1)]),_:1}),c(s,{class:"weather-text"},{default:i(()=>[u(d(D.value.desc),1)]),_:1})]),_:1})):o("v-if",!0)]),_:1})]),_:1})]),_:1}),o(" 今日情绪概览卡片 "),c(t,{class:"emotion-overview-card glass-card"},{default:i(()=>[c(t,{class:"card-header"},{default:i(()=>[c(t,{class:"card-title-section"},{default:i(()=>[c(s,{class:"card-title"},{default:i(()=>[u("今日情绪")]),_:1}),b.value?(l(),n(t,{key:0,class:"emotion-pulse"})):o("v-if",!0)]),_:1}),c(s,{class:"view-more",onClick:I},{default:i(()=>[c(s,null,{default:i(()=>[u("查看详情")]),_:1}),c(s,{class:"arrow-icon"},{default:i(()=>[u("→")]),_:1})]),_:1})]),_:1}),b.value?(l(),n(t,{key:0,class:"emotion-display"},{default:i(()=>[c(t,{class:"emotion-visual"},{default:i(()=>[c(t,{class:"emotion-icon-container"},{default:i(()=>[c(t,{class:"emotion-glow"}),c(s,{class:"emotion-icon"},{default:i(()=>[u(d(b.value.icon),1)]),_:1})]),_:1}),c(t,{class:"emotion-spectrum"},{default:i(()=>[c(t,{class:"spectrum-bar"},{default:i(()=>[c(t,{class:"spectrum-fill",style:m({width:10*b.value.intensity+"%"})},null,8,["style"])]),_:1}),c(s,{class:"intensity-text"},{default:i(()=>[u(d(b.value.intensity)+"/10",1)]),_:1})]),_:1})]),_:1}),c(t,{class:"emotion-details"},{default:i(()=>[c(s,{class:"emotion-name"},{default:i(()=>[u(d(b.value.name),1)]),_:1}),c(t,{class:"emotion-meta"},{default:i(()=>[c(t,{class:"meta-item"},{default:i(()=>[c(s,{class:"meta-icon"},{default:i(()=>[u("📍")]),_:1}),c(s,{class:"meta-text"},{default:i(()=>[u(d(b.value.scene),1)]),_:1})]),_:1}),c(t,{class:"meta-item"},{default:i(()=>[c(s,{class:"meta-icon"},{default:i(()=>[u("⏰")]),_:1}),c(s,{class:"meta-text"},{default:i(()=>[u(d(b.value.time),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(l(),n(t,{key:1,class:"no-emotion"},{default:i(()=>[c(t,{class:"empty-state"},{default:i(()=>[c(s,{class:"empty-icon"},{default:i(()=>[u("🌱")]),_:1}),c(s,{class:"no-emotion-text"},{default:i(()=>[u("今天还没有记录情绪哦")]),_:1}),c(s,{class:"encourage-text"},{default:i(()=>[u("开始记录，让心情有迹可循")]),_:1}),c(t,{class:"start-button",onClick:L},{default:i(()=>[c(s,null,{default:i(()=>[u("开始记录")]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),o(" 快速记录区域 "),c(t,{class:"quick-record-section glass-card"},{default:i(()=>[c(t,{class:"section-header"},{default:i(()=>[c(s,{class:"section-title"},{default:i(()=>[u("快速记录")]),_:1}),c(s,{class:"section-subtitle"},{default:i(()=>[u("轻点记录当下心情")]),_:1})]),_:1}),c(t,{class:"emotion-grid"},{default:i(()=>[(l(!0),f(p,null,_(j.value,e=>(l(),n(t,{class:"emotion-card",key:e.name,onClick:a=>(async e=>{try{uni.showLoading({title:"记录中..."});const a={emotion_type:e.type,intensity:5,scenario:"personal",description:`快速记录${e.name}情绪`,triggers:["快速记录"],physical_symptoms:[],coping_methods:[]};await k.createRecord(a),uni.hideLoading(),uni.showToast({title:`${e.name}情绪记录成功`,icon:"success"}),await q()}catch(a){uni.hideLoading(),console.error("快速记录失败:",a),uni.showToast({title:"记录失败，请重试",icon:"none"})}})(e)},{default:i(()=>[c(t,{class:v(["card-glow",e.type])},null,8,["class"]),c(s,{class:"emotion-icon"},{default:i(()=>[u(d(e.icon),1)]),_:2},1024),c(s,{class:"emotion-name"},{default:i(()=>[u(d(e.name),1)]),_:2},1024),c(t,{class:"emotion-ripple"})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),o(" 最近记录 "),T.value.length>0?(l(),n(t,{key:0,class:"recent-records glass-card"},{default:i(()=>[c(t,{class:"section-header"},{default:i(()=>[c(s,{class:"section-title"},{default:i(()=>[u("最近记录")]),_:1}),c(s,{class:"view-more",onClick:I},{default:i(()=>[c(s,null,{default:i(()=>[u("查看全部")]),_:1}),c(s,{class:"arrow-icon"},{default:i(()=>[u("→")]),_:1})]),_:1})]),_:1}),c(t,{class:"timeline"},{default:i(()=>[(l(!0),f(p,null,_(T.value,(e,a)=>(l(),n(t,{class:"timeline-item",key:e.id,onClick:a=>(e=>{uni.navigateTo({url:`/pages/analysis/index?recordId=${e.id}`})})(e)},{default:i(()=>[c(t,{class:"timeline-dot"},{default:i(()=>[c(s,{class:"record-emotion"},{default:i(()=>[u(d(e.emotion),1)]),_:2},1024)]),_:2},1024),c(t,{class:"timeline-content"},{default:i(()=>[c(t,{class:"record-header"},{default:i(()=>[c(s,{class:"record-name"},{default:i(()=>[u(d(e.name),1)]),_:2},1024),c(s,{class:"record-time"},{default:i(()=>[u(d(e.time),1)]),_:2},1024)]),_:2},1024),c(s,{class:"record-content"},{default:i(()=>[u(d(e.content),1)]),_:2},1024)]),_:2},1024),a<T.value.length-1?(l(),n(t,{key:0,class:"timeline-line"})):o("v-if",!0)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):o("v-if",!0),o(" 浮动记录按钮 "),c(t,{class:"floating-button",onClick:L},{default:i(()=>[c(t,{class:"button-glow"}),c(s,{class:"plus-icon"},{default:i(()=>[u("+")]),_:1}),c(t,{class:"button-ripple"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-d23669ae"]]);export{b as default};
