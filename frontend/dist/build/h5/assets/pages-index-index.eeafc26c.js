import{g as e,r as a,h as t,j as s,o as l,c as n,w as i,b as o,a as c,d as u,t as d,u as r,k as m,l as f,m as _,F as p,i as g,e as y,n as v}from"./index-cc15a06a.js";import{g as h,c as w,e as k}from"./api.ce5d8515.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";const b=x(e({__name:"index",setup(e){const x=a("å°æ˜Ž"),b=a(null),T=a([]),C=a(!0),$=a(null),D=a({icon:"â˜€ï¸",desc:"æ™´æœ—"}),j=a([{name:"å¿«ä¹",icon:"ðŸ˜„",type:"happy"},{name:"å¹³é™",icon:"ðŸ˜Œ",type:"calm"},{name:"ç„¦è™‘",icon:"ðŸ˜Ÿ",type:"anxious"},{name:"æ‚²ä¼¤",icon:"ðŸ˜¢",type:"sad"},{name:"æ„¤æ€’",icon:"ðŸ˜¡",type:"angry"},{name:"ææƒ§",icon:"ðŸ˜¨",type:"fearful"}]),R=t(()=>{const e=(new Date).getHours();return e<6?"å¤œæ·±äº†":e<12?"æ—©ä¸Šå¥½":e<18?"ä¸‹åˆå¥½":"æ™šä¸Šå¥½"}),S=t(()=>{const e=(new Date).getHours();return e<6?"ðŸŒ™":e<12?"ðŸŒ…":e<18?"â˜€ï¸":"ðŸŒ†"}),H=t(()=>{const e=new Date;return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ æ˜ŸæœŸ${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`}),L=()=>{uni.switchTab({url:"/pages/record/index"})},I=()=>{uni.switchTab({url:"/pages/statistics/index"})},M=e=>{const a=new Date(e);return`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},q=async()=>{C.value=!0;try{const[e,a]=await Promise.all([k.getTodayRecords(),k.getRecentRecords()]);if(e&&e.length>0){const a=e[0];b.value={name:z(a.emotion_type),icon:F(a.emotion_type),intensity:a.intensity,scene:P(a.scenario),time:M(a.emotion_time)}}else b.value=null;T.value=a.slice(0,3).map(e=>({id:e.id,emotion:F(e.emotion_type),name:z(e.emotion_type),time:M(e.emotion_time),content:e.description.length>30?e.description.substring(0,30)+"...":e.description}))}catch(e){console.error("åŠ è½½æ•°æ®å¤±è´¥:",e),uni.showToast({title:"æ•°æ®åŠ è½½å¤±è´¥",icon:"none"}),"Unauthorized"===(null==e?void 0:e.message)&&uni.navigateTo({url:"/pages/login/index"})}finally{C.value=!1}},z=e=>({happy:"å¿«ä¹",sad:"æ‚²ä¼¤",angry:"æ„¤æ€’",anxious:"ç„¦è™‘",calm:"å¹³é™",fearful:"ææƒ§",excited:"å…´å¥‹",frustrated:"æ²®ä¸§",grateful:"æ„Ÿæ¿€",lonely:"å­¤ç‹¬",confident:"è‡ªä¿¡",overwhelmed:"ä¸çŸ¥æ‰€æŽª"}[e]||e),F=e=>({happy:"ðŸ˜Š",sad:"ðŸ˜¢",angry:"ðŸ˜ ",anxious:"ðŸ˜°",calm:"ðŸ˜Œ",fearful:"ðŸ˜¨",excited:"ðŸ¤©",frustrated:"ðŸ˜¤",grateful:"ðŸ™",lonely:"ðŸ˜”",confident:"ðŸ˜Ž",overwhelmed:"ðŸ¤¯"}[e]||"ðŸ˜Š"),P=e=>({work:"å·¥ä½œ",study:"å­¦ä¹ ",family:"å®¶åº­",social:"ç¤¾äº¤",health:"å¥åº·",finance:"è´¢åŠ¡",relationship:"æ„Ÿæƒ…",personal:"ä¸ªäºº",entertainment:"å¨±ä¹",travel:"æ—…è¡Œ",other:"å…¶ä»–"}[e]||e);return s(()=>{(async()=>{h()?($.value=w(),$.value&&(x.value=$.value.nickname||$.value.username),await q()):uni.navigateTo({url:"/pages/login/index"})})()}),(e,a)=>{const t=g,s=y;return l(),n(t,{class:"container"},{default:i(()=>[o(" é¡¶éƒ¨æ¬¢è¿ŽåŒºåŸŸ "),c(t,{class:"welcome-section"},{default:i(()=>[c(t,{class:"welcome-background"}),c(t,{class:"welcome-content"},{default:i(()=>[c(t,{class:"greeting"},{default:i(()=>[c(s,{class:"greeting-text"},{default:i(()=>[u(d(r(R))+"ï¼Œ",1)]),_:1}),c(s,{class:"username"},{default:i(()=>[u(d(x.value||"ç”¨æˆ·"),1)]),_:1}),c(s,{class:"greeting-emoji"},{default:i(()=>[u(d(r(S)),1)]),_:1})]),_:1}),c(t,{class:"date-info"},{default:i(()=>[c(s,{class:"date"},{default:i(()=>[u(d(r(H)),1)]),_:1}),D.value?(l(),n(t,{key:0,class:"weather-info"},{default:i(()=>[c(s,{class:"weather-icon"},{default:i(()=>[u(d(D.value.icon),1)]),_:1}),c(s,{class:"weather-text"},{default:i(()=>[u(d(D.value.desc),1)]),_:1})]),_:1})):o("v-if",!0)]),_:1})]),_:1})]),_:1}),o(" ä»Šæ—¥æƒ…ç»ªæ¦‚è§ˆå¡ç‰‡ "),c(t,{class:"emotion-overview-card glass-card"},{default:i(()=>[c(t,{class:"card-header"},{default:i(()=>[c(t,{class:"card-title-section"},{default:i(()=>[c(s,{class:"card-title"},{default:i(()=>[u("ä»Šæ—¥æƒ…ç»ª")]),_:1}),b.value?(l(),n(t,{key:0,class:"emotion-pulse"})):o("v-if",!0)]),_:1}),c(s,{class:"view-more",onClick:I},{default:i(()=>[c(s,null,{default:i(()=>[u("æŸ¥çœ‹è¯¦æƒ…")]),_:1}),c(s,{class:"arrow-icon"},{default:i(()=>[u("â†’")]),_:1})]),_:1})]),_:1}),b.value?(l(),n(t,{key:0,class:"emotion-display"},{default:i(()=>[c(t,{class:"emotion-visual"},{default:i(()=>[c(t,{class:"emotion-icon-container"},{default:i(()=>[c(t,{class:"emotion-glow"}),c(s,{class:"emotion-icon"},{default:i(()=>[u(d(b.value.icon),1)]),_:1})]),_:1}),c(t,{class:"emotion-spectrum"},{default:i(()=>[c(t,{class:"spectrum-bar"},{default:i(()=>[c(t,{class:"spectrum-fill",style:m({width:10*b.value.intensity+"%"})},null,8,["style"])]),_:1}),c(s,{class:"intensity-text"},{default:i(()=>[u(d(b.value.intensity)+"/10",1)]),_:1})]),_:1})]),_:1}),c(t,{class:"emotion-details"},{default:i(()=>[c(s,{class:"emotion-name"},{default:i(()=>[u(d(b.value.name),1)]),_:1}),c(t,{class:"emotion-meta"},{default:i(()=>[c(t,{class:"meta-item"},{default:i(()=>[c(s,{class:"meta-icon"},{default:i(()=>[u("ðŸ“")]),_:1}),c(s,{class:"meta-text"},{default:i(()=>[u(d(b.value.scene),1)]),_:1})]),_:1}),c(t,{class:"meta-item"},{default:i(()=>[c(s,{class:"meta-icon"},{default:i(()=>[u("â°")]),_:1}),c(s,{class:"meta-text"},{default:i(()=>[u(d(b.value.time),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):(l(),n(t,{key:1,class:"no-emotion"},{default:i(()=>[c(t,{class:"empty-state"},{default:i(()=>[c(s,{class:"empty-icon"},{default:i(()=>[u("ðŸŒ±")]),_:1}),c(s,{class:"no-emotion-text"},{default:i(()=>[u("ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•æƒ…ç»ªå“¦")]),_:1}),c(s,{class:"encourage-text"},{default:i(()=>[u("å¼€å§‹è®°å½•ï¼Œè®©å¿ƒæƒ…æœ‰è¿¹å¯å¾ª")]),_:1}),c(t,{class:"start-button",onClick:L},{default:i(()=>[c(s,null,{default:i(()=>[u("å¼€å§‹è®°å½•")]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}),o(" å¿«é€Ÿè®°å½•åŒºåŸŸ "),c(t,{class:"quick-record-section glass-card"},{default:i(()=>[c(t,{class:"section-header"},{default:i(()=>[c(s,{class:"section-title"},{default:i(()=>[u("å¿«é€Ÿè®°å½•")]),_:1}),c(s,{class:"section-subtitle"},{default:i(()=>[u("è½»ç‚¹è®°å½•å½“ä¸‹å¿ƒæƒ…")]),_:1})]),_:1}),c(t,{class:"emotion-grid"},{default:i(()=>[(l(!0),f(p,null,_(j.value,e=>(l(),n(t,{class:"emotion-card",key:e.name,onClick:a=>(async e=>{try{uni.showLoading({title:"è®°å½•ä¸­..."});const a={emotion_type:e.type,intensity:5,scenario:"personal",description:`å¿«é€Ÿè®°å½•${e.name}æƒ…ç»ª`,triggers:["å¿«é€Ÿè®°å½•"],physical_symptoms:[],coping_methods:[]};await k.createRecord(a),uni.hideLoading(),uni.showToast({title:`${e.name}æƒ…ç»ªè®°å½•æˆåŠŸ`,icon:"success"}),await q()}catch(a){uni.hideLoading(),console.error("å¿«é€Ÿè®°å½•å¤±è´¥:",a),uni.showToast({title:"è®°å½•å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})(e)},{default:i(()=>[c(t,{class:v(["card-glow",e.type])},null,8,["class"]),c(s,{class:"emotion-icon"},{default:i(()=>[u(d(e.icon),1)]),_:2},1024),c(s,{class:"emotion-name"},{default:i(()=>[u(d(e.name),1)]),_:2},1024),c(t,{class:"emotion-ripple"})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),o(" æœ€è¿‘è®°å½• "),T.value.length>0?(l(),n(t,{key:0,class:"recent-records glass-card"},{default:i(()=>[c(t,{class:"section-header"},{default:i(()=>[c(s,{class:"section-title"},{default:i(()=>[u("æœ€è¿‘è®°å½•")]),_:1}),c(s,{class:"view-more",onClick:I},{default:i(()=>[c(s,null,{default:i(()=>[u("æŸ¥çœ‹å…¨éƒ¨")]),_:1}),c(s,{class:"arrow-icon"},{default:i(()=>[u("â†’")]),_:1})]),_:1})]),_:1}),c(t,{class:"timeline"},{default:i(()=>[(l(!0),f(p,null,_(T.value,(e,a)=>(l(),n(t,{class:"timeline-item",key:e.id,onClick:a=>(e=>{uni.navigateTo({url:`/pages/analysis/index?recordId=${e.id}`})})(e)},{default:i(()=>[c(t,{class:"timeline-dot"},{default:i(()=>[c(s,{class:"record-emotion"},{default:i(()=>[u(d(e.emotion),1)]),_:2},1024)]),_:2},1024),c(t,{class:"timeline-content"},{default:i(()=>[c(t,{class:"record-header"},{default:i(()=>[c(s,{class:"record-name"},{default:i(()=>[u(d(e.name),1)]),_:2},1024),c(s,{class:"record-time"},{default:i(()=>[u(d(e.time),1)]),_:2},1024)]),_:2},1024),c(s,{class:"record-content"},{default:i(()=>[u(d(e.content),1)]),_:2},1024)]),_:2},1024),a<T.value.length-1?(l(),n(t,{key:0,class:"timeline-line"})):o("v-if",!0)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):o("v-if",!0),o(" æµ®åŠ¨è®°å½•æŒ‰é’® "),c(t,{class:"floating-button",onClick:L},{default:i(()=>[c(t,{class:"button-glow"}),c(s,{class:"plus-icon"},{default:i(()=>[u("+")]),_:1}),c(t,{class:"button-ripple"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-d23669ae"]]);export{b as default};
