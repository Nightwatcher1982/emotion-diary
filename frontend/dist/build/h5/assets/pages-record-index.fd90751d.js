import{g as e,r as s,p as t,j as l,q as a,o as i,c as n,w as c,b as o,a as u,d,n as r,t as p,l as f,m as _,F as m,e as v,f as g,i as y,s as h,v as b,x as k}from"./index-6a23bec1.js";import{g as w,e as x}from"./api.570cf528.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";const A=C(e({__name:"index",setup(e){const C=s(1),A=s(!1),S=s(0),q=t({text:"",emotions:[],intensity:5,scene:"",triggers:[],physicalSymptoms:[],copingMethods:[],enableDeepAnalysis:!1,deepAnswers:[]}),D=s([{name:"快乐",icon:"😄",description:"愉悦、开心、满足"},{name:"焦虑",icon:"😟",description:"紧张、担心、不安"},{name:"愤怒",icon:"😡",description:"生气、愤怒、恼火"},{name:"悲伤",icon:"😢",description:"难过、沮丧、失落"},{name:"平静",icon:"😌",description:"放松、平和、宁静"},{name:"恐惧",icon:"😨",description:"害怕、恐慌、畏惧"}]),T=s([{name:"工作",icon:"💼",description:"工作、职场、同事关系"},{name:"学习",icon:"📚",description:"学习、考试、学业压力"},{name:"生活",icon:"🏠",description:"日常生活、家庭、生活琐事"},{name:"社交",icon:"👥",description:"朋友聚会、社交活动"},{name:"健康",icon:"💊",description:"身体健康、医疗相关"},{name:"其他",icon:"🌟",description:"其他特殊情况"}]),M=s(["工作压力","人际关系","身体不适","经济问题","学习困难","家庭矛盾","环境变化","时间压力","期望落空","沟通问题","决策困难","其他"]),j=s(["心跳加速","胸闷气短","肌肉紧张","头痛头晕","失眠多梦","食欲变化","疲劳乏力","出汗颤抖","胃部不适","注意力难集中","无明显症状"]),I=s(["深呼吸","运动锻炼","听音乐","倾诉交流","写日记","冥想放松","转移注意力","寻求帮助","积极思考","接受现状","暂时回避","其他方式"]),E=s([{question:"这种情绪让你身体有什么反应？",options:["心跳加速","胸闷气短","肌肉紧张","头痛头晕","没有明显反应"]},{question:"你认为这种情绪主要由什么引起？",options:["具体事件","身体状态","他人行为","环境因素","无明显原因"]},{question:"面对这种情绪，你通常会？",options:["分析问题","寻求帮助","暂时回避","自我否定","接受现状"]},{question:"这种情绪对你的影响程度？",options:["严重影响日常","中等影响","轻微影响","基本无影响"]},{question:"你希望通过什么方式改善？",options:["运动锻炼","倾诉交流","专业帮助","自我调节","暂时不处理"]}]),O=e=>{q.text=e.detail.value},L=e=>{q.intensity=e.detail.value},V=e=>{q.enableDeepAnalysis=e.detail.value},$=()=>{C.value<4&&C.value++},z=()=>{C.value>1&&C.value--},B=()=>{q.enableDeepAnalysis=!q.enableDeepAnalysis},F=()=>{uni.showToast({title:"语音输入功能开发中",icon:"none"})},R=()=>{q.enableDeepAnalysis?(q.deepAnswers=new Array(E.value.length).fill(void 0),A.value=!0,S.value=0):J()},U=()=>{S.value<E.value.length-1?S.value++:(H(),J())},G=()=>{S.value>0&&S.value--},H=()=>{A.value=!1},J=async()=>{if(!w())return uni.showToast({title:"请先登录",icon:"none"}),void uni.navigateTo({url:"/pages/login/index"});if(q.text.trim())if(0!==q.emotions.length)if(q.scene)try{uni.showLoading({title:"保存中..."});const e={emotion_type:N(q.emotions[0]),intensity:q.intensity,scenario:P(q.scene),description:q.text,triggers:q.triggers.length>0?q.triggers:["手动记录"],physical_symptoms:q.physicalSymptoms.length>0?q.physicalSymptoms:[],coping_methods:q.copingMethods.length>0?q.copingMethods:["情绪记录"],people_involved:[],location:"",weather:"",effectiveness_rating:null,is_private:!1,enable_ai_analysis:q.enableDeepAnalysis};if(q.enableDeepAnalysis&&q.deepAnswers.length>0){const s=E.value.map((e,s)=>void 0!==q.deepAnswers[s]?`${e.question}: ${e.options[q.deepAnswers[s]]}`:null).filter(e=>Boolean(e));e.triggers=[...e.triggers,...s]}console.log("提交记录数据:",e);const s=await x.createRecord(e);uni.hideLoading(),uni.showToast({title:"记录保存成功",icon:"success"}),W(),K(),setTimeout(()=>{q.enableDeepAnalysis?uni.navigateTo({url:`/pages/analysis/index?recordId=${s.id}`}):uni.switchTab({url:"/pages/index/index"})},1500)}catch(e){uni.hideLoading(),console.error("保存记录失败:",e),uni.showToast({title:(null==e?void 0:e.message)||"保存失败，请重试",icon:"none",duration:3e3})}else uni.showToast({title:"请选择相关场景",icon:"none"});else uni.showToast({title:"请选择至少一种情绪",icon:"none"});else uni.showToast({title:"请输入情绪描述",icon:"none"})},K=()=>{q.text="",q.emotions=[],q.intensity=5,q.scene="",q.triggers=[],q.physicalSymptoms=[],q.copingMethods=[],q.enableDeepAnalysis=!1,q.deepAnswers=[],C.value=1,A.value=!1,S.value=0},N=e=>({"快乐":"happy","焦虑":"anxious","愤怒":"angry","悲伤":"sad","平静":"calm","恐惧":"fearful"}[e]||"happy"),P=e=>({"工作":"work","学习":"study","生活":"personal","社交":"social","健康":"health","其他":"other"}[e]||"personal"),Q=()=>{const e={...q,currentStep:C.value,timestamp:Date.now()};uni.setStorageSync("emotion_record_draft",e),uni.showToast({title:"草稿已保存",icon:"success",duration:1500})},W=()=>{uni.removeStorageSync("emotion_record_draft")};return l(()=>{const e=a(),s=e[e.length-1],t=(null==s?void 0:s.options)||{};t.quickEmotion?(q.emotions=[t.quickEmotion],C.value=2):(()=>{try{const e=uni.getStorageSync("emotion_record_draft");if(e&&e.timestamp){Date.now()-e.timestamp<864e5?uni.showModal({title:"发现草稿",content:"检测到未完成的记录，是否继续编辑？",success:s=>{s.confirm?(Object.assign(q,e),C.value=e.currentStep||1,uni.showToast({title:"草稿已恢复",icon:"success"})):uni.removeStorageSync("emotion_record_draft")}}):uni.removeStorageSync("emotion_record_draft")}}catch(e){console.log("加载草稿失败:",e)}})()}),(e,s)=>{const t=v,l=g,a=y,w=h,x=b,J=k;return i(),n(a,{class:"container"},{default:c(()=>[o(" 页面头部 "),u(a,{class:"page-header"},{default:c(()=>[u(t,{class:"page-title"},{default:c(()=>[d("情绪记录")]),_:1}),u(l,{class:"draft-button",onClick:Q},{default:c(()=>[u(t,{class:"draft-icon"},{default:c(()=>[d("💾")]),_:1}),u(t,{class:"draft-text"},{default:c(()=>[d("保存草稿")]),_:1})]),_:1})]),_:1}),o(" 进度指示器 "),u(a,{class:"progress-bar"},{default:c(()=>[u(a,{class:r(["progress-step",{active:C.value>=1}])},{default:c(()=>[u(t,{class:"step-number"},{default:c(()=>[d("1")]),_:1}),u(t,{class:"step-text"},{default:c(()=>[d("描述")]),_:1})]),_:1},8,["class"]),u(a,{class:r(["progress-line",{active:C.value>=2}])},null,8,["class"]),u(a,{class:r(["progress-step",{active:C.value>=2}])},{default:c(()=>[u(t,{class:"step-number"},{default:c(()=>[d("2")]),_:1}),u(t,{class:"step-text"},{default:c(()=>[d("情绪")]),_:1})]),_:1},8,["class"]),u(a,{class:r(["progress-line",{active:C.value>=3}])},null,8,["class"]),u(a,{class:r(["progress-step",{active:C.value>=3}])},{default:c(()=>[u(t,{class:"step-number"},{default:c(()=>[d("3")]),_:1}),u(t,{class:"step-text"},{default:c(()=>[d("场景")]),_:1})]),_:1},8,["class"]),u(a,{class:r(["progress-line",{active:C.value>=4}])},null,8,["class"]),u(a,{class:r(["progress-step",{active:C.value>=4}])},{default:c(()=>[u(t,{class:"step-number"},{default:c(()=>[d("4")]),_:1}),u(t,{class:"step-text"},{default:c(()=>[d("详情")]),_:1})]),_:1},8,["class"])]),_:1}),o(" 步骤1: 文本输入 "),1===C.value?(i(),n(a,{key:0,class:"step-content"},{default:c(()=>[u(a,{class:"step-title"},{default:c(()=>[u(t,{class:"title"},{default:c(()=>[d("今天发生了什么？")]),_:1}),u(t,{class:"subtitle"},{default:c(()=>[d("用文字记录下你的感受")]),_:1})]),_:1}),u(a,{class:"input-section"},{default:c(()=>[u(w,{class:"diary-input",modelValue:q.text,"onUpdate:modelValue":s[0]||(s[0]=e=>q.text=e),placeholder:"今天发生了什么？一句话描述也可以...",maxlength:"200","auto-height":"",onInput:O},null,8,["modelValue"]),u(a,{class:"char-count"},{default:c(()=>[u(t,{class:"count"},{default:c(()=>[d(p(q.text.length),1)]),_:1}),u(t,{class:"max"},{default:c(()=>[d("/200")]),_:1})]),_:1})]),_:1}),o(" 语音输入按钮 "),u(a,{class:"voice-input",onClick:F},{default:c(()=>[u(t,{class:"voice-icon"},{default:c(()=>[d("🎤")]),_:1}),u(t,{class:"voice-text"},{default:c(()=>[d("语音输入")]),_:1})]),_:1}),u(a,{class:"step-actions"},{default:c(()=>[u(l,{class:"next-button",onClick:$,disabled:!q.text.trim()},{default:c(()=>[d(" 下一步 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):o("v-if",!0),o(" 步骤2: 情绪选择 "),2===C.value?(i(),n(a,{key:1,class:"step-content"},{default:c(()=>[u(a,{class:"step-title"},{default:c(()=>[u(t,{class:"title"},{default:c(()=>[d("选择你的情绪")]),_:1}),u(t,{class:"subtitle"},{default:c(()=>[d("可以选择多个情绪")]),_:1})]),_:1}),u(a,{class:"emotions-grid"},{default:c(()=>[(i(!0),f(m,null,_(D.value,e=>(i(),n(a,{class:r(["emotion-item",{selected:q.emotions.includes(e.name)}]),key:e.name,onClick:s=>(e=>{const s=q.emotions.indexOf(e);s>-1?q.emotions.splice(s,1):q.emotions.push(e)})(e.name)},{default:c(()=>[u(t,{class:"emotion-icon"},{default:c(()=>[d(p(e.icon),1)]),_:2},1024),u(t,{class:"emotion-name"},{default:c(()=>[d(p(e.name),1)]),_:2},1024),u(a,{class:"emotion-desc"},{default:c(()=>[d(p(e.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1}),o(" 情绪强度滑块 "),q.emotions.length>0?(i(),n(a,{key:0,class:"intensity-section"},{default:c(()=>[u(a,{class:"intensity-title"},{default:c(()=>[u(t,null,{default:c(()=>[d("情绪强度")]),_:1}),u(t,{class:"intensity-value"},{default:c(()=>[d(p(q.intensity)+"/10",1)]),_:1})]),_:1}),u(x,{class:"intensity-slider",value:q.intensity,onChange:L,min:"1",max:"10",step:"1",activeColor:"#4A90E2",backgroundColor:"#e0e0e0","block-size":"20"},null,8,["value"]),u(a,{class:"intensity-labels"},{default:c(()=>[u(t,{class:"label-left"},{default:c(()=>[d("轻微")]),_:1}),u(t,{class:"label-right"},{default:c(()=>[d("强烈")]),_:1})]),_:1})]),_:1})):o("v-if",!0),u(a,{class:"step-actions"},{default:c(()=>[u(l,{class:"prev-button",onClick:z},{default:c(()=>[d("上一步")]),_:1}),u(l,{class:"next-button",onClick:$,disabled:0===q.emotions.length},{default:c(()=>[d(" 下一步 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):o("v-if",!0),o(" 步骤3: 场景选择 "),3===C.value?(i(),n(a,{key:2,class:"step-content"},{default:c(()=>[u(a,{class:"step-title"},{default:c(()=>[u(t,{class:"title"},{default:c(()=>[d("选择相关场景")]),_:1}),u(t,{class:"subtitle"},{default:c(()=>[d("这有助于AI更好地分析")]),_:1})]),_:1}),u(a,{class:"scenes-list"},{default:c(()=>[(i(!0),f(m,null,_(T.value,e=>(i(),n(a,{class:r(["scene-item",{selected:q.scene===e.name}]),key:e.name,onClick:s=>{return t=e.name,void(q.scene=t);var t}},{default:c(()=>[u(t,{class:"scene-icon"},{default:c(()=>[d(p(e.icon),1)]),_:2},1024),u(a,{class:"scene-info"},{default:c(()=>[u(t,{class:"scene-name"},{default:c(()=>[d(p(e.name),1)]),_:2},1024),u(t,{class:"scene-desc"},{default:c(()=>[d(p(e.description),1)]),_:2},1024)]),_:2},1024),q.scene===e.name?(i(),n(t,{key:0,class:"check-icon"},{default:c(()=>[d("✓")]),_:1})):o("v-if",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1}),o(" 深度分析开关 "),u(a,{class:"deep-analysis-section"},{default:c(()=>[u(a,{class:"analysis-header",onClick:B},{default:c(()=>[u(a,{class:"analysis-info"},{default:c(()=>[u(t,{class:"analysis-title"},{default:c(()=>[d("深度分析")]),_:1}),u(t,{class:"analysis-desc"},{default:c(()=>[d("回答几个问题，获得更精准的AI建议")]),_:1})]),_:1}),u(J,{checked:q.enableDeepAnalysis,onChange:V,color:"#4A90E2"},null,8,["checked"])]),_:1})]),_:1}),u(a,{class:"step-actions"},{default:c(()=>[u(l,{class:"prev-button",onClick:z},{default:c(()=>[d("上一步")]),_:1}),u(l,{class:"next-button",onClick:$,disabled:!q.scene},{default:c(()=>[d(" 下一步 ")]),_:1},8,["disabled"])]),_:1})]),_:1})):o("v-if",!0),o(" 步骤4: 触发因素和身体症状 "),4===C.value?(i(),n(a,{key:3,class:"step-content"},{default:c(()=>[u(a,{class:"step-title"},{default:c(()=>[u(t,{class:"title"},{default:c(()=>[d("详细信息")]),_:1}),u(t,{class:"subtitle"},{default:c(()=>[d("选择触发因素和身体症状（可选）")]),_:1})]),_:1}),o(" 触发因素 "),u(a,{class:"detail-section"},{default:c(()=>[u(a,{class:"section-title"},{default:c(()=>[u(t,null,{default:c(()=>[d("触发因素")]),_:1})]),_:1}),u(a,{class:"triggers-grid"},{default:c(()=>[(i(!0),f(m,null,_(M.value,e=>(i(),n(a,{class:r(["trigger-item",{selected:q.triggers.includes(e)}]),key:e,onClick:s=>(e=>{const s=q.triggers.indexOf(e);s>-1?q.triggers.splice(s,1):q.triggers.push(e)})(e)},{default:c(()=>[u(t,{class:"trigger-text"},{default:c(()=>[d(p(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),o(" 身体症状 "),u(a,{class:"detail-section"},{default:c(()=>[u(a,{class:"section-title"},{default:c(()=>[u(t,null,{default:c(()=>[d("身体症状")]),_:1})]),_:1}),u(a,{class:"symptoms-grid"},{default:c(()=>[(i(!0),f(m,null,_(j.value,e=>(i(),n(a,{class:r(["symptom-item",{selected:q.physicalSymptoms.includes(e)}]),key:e,onClick:s=>(e=>{const s=q.physicalSymptoms.indexOf(e);s>-1?q.physicalSymptoms.splice(s,1):q.physicalSymptoms.push(e)})(e)},{default:c(()=>[u(t,{class:"symptom-text"},{default:c(()=>[d(p(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),o(" 应对方式 "),u(a,{class:"detail-section"},{default:c(()=>[u(a,{class:"section-title"},{default:c(()=>[u(t,null,{default:c(()=>[d("应对方式")]),_:1})]),_:1}),u(a,{class:"coping-grid"},{default:c(()=>[(i(!0),f(m,null,_(I.value,e=>(i(),n(a,{class:r(["coping-item",{selected:q.copingMethods.includes(e)}]),key:e,onClick:s=>(e=>{const s=q.copingMethods.indexOf(e);s>-1?q.copingMethods.splice(s,1):q.copingMethods.push(e)})(e)},{default:c(()=>[u(t,{class:"coping-text"},{default:c(()=>[d(p(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),o(" 深度分析开关 "),u(a,{class:"deep-analysis-section"},{default:c(()=>[u(a,{class:"analysis-header",onClick:B},{default:c(()=>[u(a,{class:"analysis-info"},{default:c(()=>[u(t,{class:"analysis-title"},{default:c(()=>[d("深度分析")]),_:1}),u(t,{class:"analysis-desc"},{default:c(()=>[d("回答几个问题，获得更精准的AI建议")]),_:1})]),_:1}),u(J,{checked:q.enableDeepAnalysis,onChange:V,color:"#4A90E2"},null,8,["checked"])]),_:1})]),_:1}),o(" 记录预览 "),u(a,{class:"record-preview"},{default:c(()=>[u(a,{class:"preview-title"},{default:c(()=>[u(t,null,{default:c(()=>[d("记录预览")]),_:1})]),_:1}),u(a,{class:"preview-content"},{default:c(()=>[u(a,{class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("情绪描述：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.text||"暂无"),1)]),_:1})]),_:1}),u(a,{class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("主要情绪：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.emotions.join("、")||"暂无"),1)]),_:1})]),_:1}),u(a,{class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("情绪强度：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.intensity)+"/10",1)]),_:1})]),_:1}),u(a,{class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("相关场景：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.scene||"暂无"),1)]),_:1})]),_:1}),q.triggers.length>0?(i(),n(a,{key:0,class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("触发因素：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.triggers.join("、")),1)]),_:1})]),_:1})):o("v-if",!0),q.physicalSymptoms.length>0?(i(),n(a,{key:1,class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("身体症状：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.physicalSymptoms.join("、")),1)]),_:1})]),_:1})):o("v-if",!0),q.copingMethods.length>0?(i(),n(a,{key:2,class:"preview-item"},{default:c(()=>[u(t,{class:"preview-label"},{default:c(()=>[d("应对方式：")]),_:1}),u(t,{class:"preview-text"},{default:c(()=>[d(p(q.copingMethods.join("、")),1)]),_:1})]),_:1})):o("v-if",!0)]),_:1})]),_:1}),u(a,{class:"step-actions"},{default:c(()=>[u(l,{class:"prev-button",onClick:z},{default:c(()=>[d("上一步")]),_:1}),u(l,{class:"save-button",onClick:R},{default:c(()=>[d(p(q.enableDeepAnalysis?"继续深度分析":"保存记录"),1)]),_:1})]),_:1})]),_:1})):o("v-if",!0),o(" 深度分析问题 "),A.value?(i(),n(a,{key:4,class:"deep-analysis-modal"},{default:c(()=>[u(a,{class:"modal-content"},{default:c(()=>[u(a,{class:"modal-header"},{default:c(()=>[u(t,{class:"modal-title"},{default:c(()=>[d("深度分析 ("+p(S.value+1)+"/"+p(E.value.length)+")",1)]),_:1}),u(t,{class:"close-btn",onClick:H},{default:c(()=>[d("×")]),_:1})]),_:1}),u(a,{class:"question-content"},{default:c(()=>[u(t,{class:"question-text"},{default:c(()=>[d(p(E.value[S.value].question),1)]),_:1}),u(a,{class:"answer-options"},{default:c(()=>[(i(!0),f(m,null,_(E.value[S.value].options,(e,s)=>(i(),n(a,{class:r(["option-item",{selected:q.deepAnswers[S.value]===s}]),key:s,onClick:e=>{return t=s,void(q.deepAnswers[S.value]=t);var t}},{default:c(()=>[u(t,{class:"option-text"},{default:c(()=>[d(p(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),u(a,{class:"question-actions"},{default:c(()=>[S.value>0?(i(),n(l,{key:0,class:"prev-question-btn",onClick:G},{default:c(()=>[d(" 上一题 ")]),_:1})):o("v-if",!0),u(l,{class:"next-question-btn",onClick:U,disabled:void 0===q.deepAnswers[S.value]},{default:c(()=>[d(p(S.value===E.value.length-1?"完成分析":"下一题"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):o("v-if",!0)]),_:1})}}}),[["__scopeId","data-v-768f4a61"]]);export{A as default};
