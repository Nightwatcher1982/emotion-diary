import{g as e,r as t,h as a,j as s,q as i,o as l,c as n,w as c,b as o,a as d,d as u,n as r,t as m,l as f,F as p,m as _,u as y,e as g,i as v,f as h,y as w,k}from"./index-6afd3b48.js";import{g as b,e as C,d as x}from"./api.ae518a48.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";const T=A(e({__name:"index",setup(e){const A=t(!0),T=t(0),I=t({}),S=t([{type:"immediate",title:"即时缓解",icon:"⚡"},{type:"longterm",title:"长期改善",icon:"🎯"},{type:"lifestyle",title:"生活方式",icon:"🌱"},{type:"social",title:"社交支持",icon:"👥"}]),P=a(()=>{if(!I.value.suggestions)return[];const e=S.value[T.value].type;return I.value.suggestions[e]||[]}),M=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},D=e=>({easy:"容易",medium:"中等",hard:"困难"}[e]||"中等"),E=e=>e||"稳定",$=e=>{uni.showModal({title:"应用建议",content:`确定要将"${e.title}"添加到今日计划吗？`,success:e=>{e.confirm&&uni.showToast({title:"已添加到计划",icon:"success"})}})},j=()=>{uni.share({provider:"weixin",type:0,title:"我的情绪分析报告",summary:"通过AI分析，我对自己的情绪有了更深的了解",success:()=>{uni.showToast({title:"分享成功",icon:"success"})}})},R=()=>{uni.switchTab({url:"/pages/record/index"})},q=async()=>{uni.showModal({title:"重新分析",content:"将基于最新的情绪记录重新进行AI分析，是否继续？",success:async e=>{e.confirm&&await F()}})},z=async()=>{try{const e={analysis_data:I.value,created_at:(new Date).toISOString(),analysis_type:"comprehensive"};uni.setStorageSync("latest_analysis",e),uni.showToast({title:"分析结果已保存",icon:"success"})}catch(e){console.error("保存分析结果失败:",e),uni.showToast({title:"保存失败",icon:"none"})}},B=e=>{console.log("图表触摸事件",e)},F=async e=>{try{if(!b())return uni.showToast({title:"请先登录",icon:"none"}),void uni.navigateTo({url:"/pages/login/index"});A.value=!0;let t=[];if(e){t=[await C.getRecordById(e)]}else{const e=await C.getRecentRecords();t=e.results||e}if(!t||0===t.length)return uni.showModal({title:"暂无数据",content:"还没有情绪记录，请先记录一些情绪数据",success:e=>{e.confirm&&uni.switchTab({url:"/pages/record/index"})}}),void(A.value=!1);const a={emotion_records:t.map(e=>e.id),analysis_type:"comprehensive",include_suggestions:!0,include_trend:!0},s=await x.requestAnalysis(a);I.value=L(s,t),A.value=!1}catch(t){console.error("获取分析数据失败:",t),A.value=!1,uni.showToast({title:"AI分析服务暂时不可用，显示示例数据",icon:"none",duration:3e3}),setTimeout(()=>{I.value={timestamp:Date.now(),primaryEmotion:{name:"焦虑",icon:"😟",confidence:85},emotionSpectrum:[{name:"焦虑",percentage:45},{name:"担心",percentage:30},{name:"紧张",percentage:15},{name:"不安",percentage:10}],insights:[{type:"pattern",icon:"🔍",title:"情绪模式识别",content:"你的焦虑情绪主要出现在工作场景中，特别是面对截止日期时。这是一种常见的适应性焦虑，说明你对工作很负责。"},{type:"trigger",icon:"⚡",title:"触发因素分析",content:'分析显示，时间压力和完美主义倾向是你焦虑的主要触发因素。建议学习时间管理技巧和接受"足够好"的标准。'},{type:"strength",icon:"💪",title:"情绪优势",content:"你具有很好的情绪觉察能力，能够准确识别和描述自己的感受。这是情绪管理的重要基础。"}],suggestions:{immediate:[{id:1,title:"4-7-8呼吸法",description:"吸气4秒，屏气7秒，呼气8秒。重复3-4次可快速缓解焦虑。",difficulty:"easy"},{id:2,title:"5-4-3-2-1接地技巧",description:"说出5个看到的、4个听到的、3个摸到的、2个闻到的、1个尝到的。",difficulty:"easy"}],longterm:[{id:3,title:"认知重构练习",description:"识别并挑战消极思维模式，用更平衡的想法替代。",difficulty:"medium"},{id:4,title:"正念冥想",description:"每天10-15分钟的正念练习，提高情绪调节能力。",difficulty:"medium"}],lifestyle:[{id:5,title:"规律运动",description:"每周3-4次有氧运动，每次30分钟，有助于缓解焦虑。",difficulty:"medium"},{id:6,title:"睡眠优化",description:"建立规律的睡眠时间，创造良好的睡眠环境。",difficulty:"hard"}],social:[{id:7,title:"寻求支持",description:"与信任的朋友或家人分享你的感受，获得情感支持。",difficulty:"medium"},{id:8,title:"专业咨询",description:"如果焦虑持续影响生活，考虑寻求专业心理咨询师的帮助。",difficulty:"hard"}]},trend:{average:6.5,volatility:"中等",direction:"稳定"},deepAnalysis:{score:78,dimensions:[{name:"情绪觉察",score:8,description:"能够准确识别自己的情绪状态"},{name:"应对策略",score:6,description:"具备一定的情绪调节技巧，但需要加强"},{name:"社会支持",score:7,description:"拥有良好的社会支持网络"},{name:"生活平衡",score:5,description:"工作与生活平衡需要改善"}]},actionPlan:[{title:"练习深呼吸",description:"每天早晨练习5分钟深呼吸",completed:!1},{title:"记录触发因素",description:"观察并记录引起焦虑的具体情况",completed:!1},{title:"尝试正念练习",description:"下载冥想App，尝试10分钟正念练习",completed:!1},{title:"制定时间计划",description:"为重要任务制定详细的时间计划",completed:!1},{title:"与朋友交流",description:"主动与一位朋友分享近期的感受",completed:!1},{title:"评估进展",description:"回顾本周的情绪变化和应对效果",completed:!1},{title:"调整策略",description:"根据一周的实践调整应对策略",completed:!1}]}},1e3)}},L=(e,t)=>{const a=t[0];return{timestamp:Date.now(),recordId:a.id,primaryEmotion:{name:N(a.emotion_type),icon:O(a.emotion_type),confidence:e.confidence||85},emotionSpectrum:G(a,e),insights:H(e.insights||[]),suggestions:K(e.suggestions||{}),trend:Q(e.trend||{}),deepAnalysis:U(e.deep_analysis||{}),actionPlan:V(e.action_plan||[])}},N=e=>({happy:"快乐",sad:"悲伤",angry:"愤怒",anxious:"焦虑",calm:"平静",fearful:"恐惧"}[e]||"未知"),O=e=>({happy:"😄",sad:"😢",angry:"😡",anxious:"😟",calm:"😌",fearful:"😨"}[e]||"😐"),G=(e,t)=>{const a=t.emotion_spectrum||[];if(a.length>0)return a.map(e=>({name:N(e.emotion),percentage:Math.round(100*e.confidence)}));const s=e.intensity||5;return[{name:N(e.emotion_type),percentage:10*s},{name:"中性",percentage:Math.max(0,100-10*s)}]},H=e=>0===e.length?[{type:"pattern",icon:"🔍",title:"情绪模式识别",content:"正在分析您的情绪模式，请多记录几次以获得更准确的分析。"}]:e.map(e=>({type:e.type||"general",icon:J(e.type),title:e.title||"AI洞察",content:e.content||e.description||""})),J=e=>({pattern:"🔍",trigger:"⚡",strength:"💪",recommendation:"💡",trend:"📈",warning:"⚠️"}[e]||"💭"),K=e=>{const t={immediate:[{id:1,title:"深呼吸练习",description:"进行3-5次深呼吸，帮助快速缓解紧张情绪。",difficulty:"easy"}],longterm:[{id:2,title:"情绪日记",description:"坚持记录情绪变化，提高情绪觉察能力。",difficulty:"medium"}],lifestyle:[{id:3,title:"规律作息",description:"保持规律的睡眠和饮食习惯。",difficulty:"medium"}],social:[{id:4,title:"寻求支持",description:"与信任的人分享你的感受。",difficulty:"easy"}]};return{immediate:e.immediate||t.immediate,longterm:e.longterm||t.longterm,lifestyle:e.lifestyle||t.lifestyle,social:e.social||t.social}},Q=e=>({average:e.average||5,volatility:e.volatility||"中等",direction:e.direction||"稳定"}),U=e=>({score:e.score||70,dimensions:e.dimensions||[{name:"情绪觉察",score:7,description:"能够识别自己的情绪状态"},{name:"应对策略",score:6,description:"具备基本的情绪调节能力"}]}),V=e=>0===e.length?[{title:"记录情绪",description:"每天记录一次情绪状态",completed:!1},{title:"练习放松",description:"尝试深呼吸或冥想",completed:!1},{title:"评估进展",description:"回顾一周的情绪变化",completed:!1}]:e.map(e=>({title:e.title||e.name||"",description:e.description||"",completed:e.completed||!1}));return s(()=>{const e=i(),t=(e[e.length-1].options||{}).recordId;F(t)}),(e,t)=>{const a=g,s=v,i=h,b=w;return l(),n(s,{class:"container"},{default:c(()=>[o(" 页面头部 "),A.value?o("v-if",!0):(l(),n(s,{key:0,class:"page-header"},{default:c(()=>[d(s,{class:"header-left"},{default:c(()=>[d(a,{class:"page-title"},{default:c(()=>[u("AI分析报告")]),_:1}),d(s,{class:"analysis-status-section"},{default:c(()=>{var e;return[d(a,{class:"analysis-status"},{default:c(()=>[u("✨ 智能分析完成")]),_:1}),d(s,{class:r(["ai-status-badge",{"ai-powered":null==(e=I.value)?void 0:e.ai_powered}])},{default:c(()=>[d(a,{class:"status-icon"},{default:c(()=>{return[u(m((e=I.value,(null==e?void 0:e.ai_powered)?"🤖":"📊")),1)];var e}),_:1}),d(a,{class:"status-text"},{default:c(()=>{return[u(m((e=I.value,(null==e?void 0:e.ai_powered)?"AI驱动":"数据分析")),1)];var e}),_:1})]),_:1},8,["class"])]}),_:1})]),_:1}),d(s,{class:"header-actions"},{default:c(()=>[d(i,{class:"header-btn",onClick:z},{default:c(()=>[d(a,{class:"btn-icon"},{default:c(()=>[u("💾")]),_:1}),d(a,{class:"btn-text"},{default:c(()=>[u("保存")]),_:1})]),_:1}),d(i,{class:"header-btn",onClick:q},{default:c(()=>[d(a,{class:"btn-icon"},{default:c(()=>[u("🔄")]),_:1}),d(a,{class:"btn-text"},{default:c(()=>[u("重新分析")]),_:1})]),_:1})]),_:1})]),_:1})),o(" 加载状态 "),A.value?(l(),n(s,{key:1,class:"loading-section"},{default:c(()=>[d(s,{class:"loading-animation"},{default:c(()=>[d(s,{class:"loading-dots"},{default:c(()=>[d(s,{class:"dot"}),d(s,{class:"dot"}),d(s,{class:"dot"})]),_:1}),d(a,{class:"loading-text"},{default:c(()=>[u("AI正在分析中...")]),_:1})]),_:1})]),_:1})):(l(),f(p,{key:2},[o(" 分析结果 "),d(s,{class:"analysis-content"},{default:c(()=>[o(" 情绪概览卡片 "),d(s,{class:"emotion-overview"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("情绪分析")]),_:1}),d(a,{class:"analysis-time"},{default:c(()=>[u(m(M(I.value.timestamp)),1)]),_:1})]),_:1}),d(s,{class:"primary-emotion"},{default:c(()=>[d(a,{class:"emotion-icon"},{default:c(()=>[u(m(I.value.primaryEmotion.icon),1)]),_:1}),d(s,{class:"emotion-details"},{default:c(()=>[d(a,{class:"emotion-name"},{default:c(()=>[u(m(I.value.primaryEmotion.name),1)]),_:1}),d(a,{class:"emotion-confidence"},{default:c(()=>[u("置信度: "+m(I.value.primaryEmotion.confidence)+"%",1)]),_:1})]),_:1})]),_:1}),I.value.emotionSpectrum?(l(),n(s,{key:0,class:"emotion-spectrum"},{default:c(()=>[d(a,{class:"spectrum-title"},{default:c(()=>[u("情绪光谱")]),_:1}),d(s,{class:"spectrum-bars"},{default:c(()=>[(l(!0),f(p,null,_(I.value.emotionSpectrum,e=>(l(),n(s,{class:"spectrum-item",key:e.name},{default:c(()=>[d(a,{class:"spectrum-name"},{default:c(()=>[u(m(e.name),1)]),_:2},1024),d(s,{class:"spectrum-bar"},{default:c(()=>[d(s,{class:"spectrum-fill",style:k({width:e.percentage+"%"})},null,8,["style"])]),_:2},1024),d(a,{class:"spectrum-value"},{default:c(()=>[u(m(e.percentage)+"%",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):o("v-if",!0)]),_:1}),o(" AI洞察 "),d(s,{class:"ai-insights"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("AI洞察")]),_:1}),d(a,{class:"ai-badge"},{default:c(()=>[u("✨ AI分析")]),_:1})]),_:1}),(l(!0),f(p,null,_(I.value.insights,e=>(l(),n(s,{class:"insight-item",key:e.type},{default:c(()=>[d(s,{class:"insight-header"},{default:c(()=>[d(a,{class:"insight-icon"},{default:c(()=>[u(m(e.icon),1)]),_:2},1024),d(a,{class:"insight-title"},{default:c(()=>[u(m(e.title),1)]),_:2},1024),d(i,{class:"insight-share-btn",onClick:t=>{return a=e,void uni.setClipboardData({data:`AI洞察: ${a.content}`,success:()=>{uni.showToast({title:"已复制到剪贴板",icon:"success"})}});var a}},{default:c(()=>[d(a,{class:"share-icon"},{default:c(()=>[u("📋")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),d(a,{class:"insight-content"},{default:c(()=>[u(m(e.content),1)]),_:2},1024),e.actionable?(l(),n(s,{key:0,class:"insight-actions"},{default:c(()=>[d(i,{class:"insight-action-btn",onClick:t=>(e=>{uni.showToast({title:"已添加到行动计划",icon:"success"});const t={title:`实践：${e.title}`,description:e.content,completed:!1};I.value.actionPlan&&I.value.actionPlan.push(t)})(e)},{default:c(()=>[u(" 应用建议 ")]),_:2},1032,["onClick"])]),_:2},1024)):o("v-if",!0)]),_:2},1024))),128))]),_:1}),o(" 个性化建议 "),d(s,{class:"suggestions"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("个性化建议")]),_:1})]),_:1}),d(s,{class:"suggestion-tabs"},{default:c(()=>[(l(!0),f(p,null,_(S.value,(e,t)=>(l(),n(s,{class:r(["tab-item",{active:T.value===t}]),key:e.type,onClick:e=>(e=>{T.value=e})(t)},{default:c(()=>[d(a,{class:"tab-icon"},{default:c(()=>[u(m(e.icon),1)]),_:2},1024),d(a,{class:"tab-text"},{default:c(()=>[u(m(e.title),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1}),d(s,{class:"suggestion-content"},{default:c(()=>[(l(!0),f(p,null,_(y(P),e=>(l(),n(s,{class:"suggestion-item",key:e.id},{default:c(()=>[d(s,{class:"suggestion-header"},{default:c(()=>[d(a,{class:"suggestion-title"},{default:c(()=>[u(m(e.title),1)]),_:2},1024),d(a,{class:r(["difficulty-tag",e.difficulty])},{default:c(()=>[u(m(D(e.difficulty)),1)]),_:2},1032,["class"])]),_:2},1024),d(a,{class:"suggestion-desc"},{default:c(()=>[u(m(e.description),1)]),_:2},1024),d(s,{class:"suggestion-actions"},{default:c(()=>[d(i,{class:"action-btn primary",onClick:t=>$(e)},{default:c(()=>[u(" 试试看 ")]),_:2},1032,["onClick"]),d(i,{class:"action-btn secondary",onClick:e=>{uni.showToast({title:"已收藏",icon:"success"})}},{default:c(()=>[u(" 收藏 ")]),_:2},1032,["onClick"]),d(i,{class:"action-btn tertiary",onClick:t=>(e=>{uni.showModal({title:e.title,content:`${e.description}\n\n难度：${D(e.difficulty)}\n\n是否要将此建议添加到今日计划中？`,confirmText:"添加",cancelText:"取消",success:t=>{t.confirm&&$(e)}})})(e)},{default:c(()=>[u(" 详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(" 情绪趋势 "),I.value.trend?(l(),n(s,{key:0,class:"emotion-trend"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("情绪趋势")]),_:1}),d(a,{class:"trend-period"},{default:c(()=>[u("近7天")]),_:1})]),_:1}),d(s,{class:"trend-chart"},{default:c(()=>[d(b,{"canvas-id":"trendChart",class:"chart-canvas",onTouchstart:B})]),_:1}),d(s,{class:"trend-summary"},{default:c(()=>[d(s,{class:"trend-item"},{default:c(()=>[d(a,{class:"trend-label"},{default:c(()=>[u("平均情绪")]),_:1}),d(a,{class:"trend-value"},{default:c(()=>[u(m(I.value.trend.average)+"/10",1)]),_:1})]),_:1}),d(s,{class:"trend-item"},{default:c(()=>[d(a,{class:"trend-label"},{default:c(()=>[u("波动程度")]),_:1}),d(a,{class:"trend-value"},{default:c(()=>[u(m(I.value.trend.volatility),1)]),_:1})]),_:1}),d(s,{class:"trend-item"},{default:c(()=>{return[d(a,{class:"trend-label"},{default:c(()=>[u("改善趋势")]),_:1}),d(a,{class:r(["trend-value",(e=I.value.trend.direction,"上升"===e?"trend-up":"下降"===e?"trend-down":"trend-stable")])},{default:c(()=>[u(m(E(I.value.trend.direction)),1)]),_:1},8,["class"])];var e}),_:1})]),_:1})]),_:1})):o("v-if",!0),o(" 深度分析结果 "),I.value.deepAnalysis?(l(),n(s,{key:1,class:"deep-analysis"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("深度分析")]),_:1}),d(a,{class:"analysis-score"},{default:c(()=>[u("分析得分: "+m(I.value.deepAnalysis.score)+"/100",1)]),_:1})]),_:1}),d(s,{class:"analysis-dimensions"},{default:c(()=>[(l(!0),f(p,null,_(I.value.deepAnalysis.dimensions,e=>(l(),n(s,{class:"dimension-item",key:e.name},{default:c(()=>[d(s,{class:"dimension-header"},{default:c(()=>[d(a,{class:"dimension-name"},{default:c(()=>[u(m(e.name),1)]),_:2},1024),d(a,{class:"dimension-score"},{default:c(()=>[u(m(e.score)+"/10",1)]),_:2},1024)]),_:2},1024),d(s,{class:"dimension-bar"},{default:c(()=>[d(s,{class:"dimension-fill",style:k({width:e.score/10*100+"%"})},null,8,["style"])]),_:2},1024),d(a,{class:"dimension-desc"},{default:c(()=>[u(m(e.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):o("v-if",!0),o(" 行动计划 "),d(s,{class:"action-plan"},{default:c(()=>[d(s,{class:"card-header"},{default:c(()=>[d(a,{class:"card-title"},{default:c(()=>[u("行动计划")]),_:1}),d(a,{class:"plan-duration"},{default:c(()=>[u("7天计划")]),_:1})]),_:1}),d(s,{class:"plan-timeline"},{default:c(()=>[(l(!0),f(p,null,_(I.value.actionPlan,(e,t)=>(l(),n(s,{class:"timeline-item",key:t},{default:c(()=>[d(s,{class:r(["timeline-dot",{completed:e.completed}])},null,8,["class"]),d(s,{class:"timeline-content"},{default:c(()=>[d(a,{class:"timeline-date"},{default:c(()=>[u("第"+m(t+1)+"天",1)]),_:2},1024),d(a,{class:"timeline-title"},{default:c(()=>[u(m(e.title),1)]),_:2},1024),d(a,{class:"timeline-desc"},{default:c(()=>[u(m(e.description),1)]),_:2},1024),e.completed?o("v-if",!0):(l(),n(s,{key:0,class:"timeline-actions"},{default:c(()=>[d(i,{class:"complete-btn",onClick:e=>(e=>{I.value.actionPlan&&I.value.actionPlan[e]&&(I.value.actionPlan[e].completed=!0,uni.showToast({title:"任务完成！",icon:"success"}))})(t)},{default:c(()=>[u(" 完成 ")]),_:2},1032,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})],2112)),o(" 底部操作 "),A.value?o("v-if",!0):(l(),n(s,{key:3,class:"bottom-actions"},{default:c(()=>[d(i,{class:"action-button secondary",onClick:j},{default:c(()=>[u(" 分享分析 ")]),_:1}),d(i,{class:"action-button primary",onClick:R},{default:c(()=>[u(" 新的记录 ")]),_:1})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-fe0ee01d"]]);export{T as default};
