import{g as e,r as a,h as l,j as t,o as s,c as n,w as i,b as c,a as u,d as o,t as d,l as r,m as f,F as _,u as v,e as g,i as m,A as h,I as p,s as b,B as k,x as y,f as x,n as w}from"./index-6afd3b48.js";import{c as C,a as T,b as V}from"./api.ae518a48.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";const F=j(e({__name:"edit",setup(e){const j=a({nickname:"",bio:"",gender:"N",birth_date:"",avatar:"",notification_enabled:!0,daily_reminder_time:"21:00",theme_preference:"auto",analytics_consent:!0}),F=a(!1),I=a([{value:"M",label:"男",icon:"👨"},{value:"F",label:"女",icon:"👩"},{value:"O",label:"其他",icon:"🧑"},{value:"N",label:"保密",icon:"🤐"}]),L=a(["跟随系统","浅色主题","深色主题"]),N=a(0),B=l(()=>({auto:"跟随系统",light:"浅色主题",dark:"深色主题"}[j.value.theme_preference]||"跟随系统")),P=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{j.value.avatar=e.tempFilePaths[0],uni.showToast({title:"头像已选择",icon:"success"})},fail:()=>{uni.showToast({title:"选择头像失败",icon:"none"})}})},U=e=>{j.value.birth_date=e.detail.value},z=e=>{const a=e.detail.value;N.value=a;j.value.theme_preference=["auto","light","dark"][a]},A=e=>{j.value.notification_enabled=e.detail.value},M=e=>{j.value.daily_reminder_time=e.detail.value},O=e=>{j.value.analytics_consent=e.detail.value},q=async()=>{var e,a;if(!F.value)try{if(F.value=!0,!j.value.nickname.trim())return void uni.showToast({title:"请输入昵称",icon:"none"});uni.showLoading({title:"保存中..."});await T.updateProfile(j.value);const e=C();if(e){const a={...e,...j.value};V(a)}uni.hideLoading(),uni.showToast({title:"保存成功",icon:"success"}),setTimeout(()=>{uni.navigateBack()},1500)}catch(l){uni.hideLoading(),console.error("保存失败:",l);const t=(null==(a=null==(e=null==l?void 0:l.response)?void 0:e.data)?void 0:a.message)||"保存失败，请重试";uni.showToast({title:t,icon:"none"})}finally{F.value=!1}};return t(()=>{(async()=>{try{const e=C();if(e){j.value={nickname:e.nickname||"",bio:e.bio||"",gender:e.gender||"N",birth_date:e.birth_date||"",avatar:e.avatar||"",notification_enabled:!1!==e.notification_enabled,daily_reminder_time:e.daily_reminder_time||"21:00",theme_preference:e.theme_preference||"auto",analytics_consent:!1!==e.analytics_consent};const a={auto:0,light:1,dark:2};N.value=a[j.value.theme_preference]||0}}catch(e){console.error("加载用户信息失败:",e),uni.showToast({title:"加载失败，请重试",icon:"none"})}})()}),(e,a)=>{const l=g,t=m,C=h,T=p,V=b,D=k,E=y,G=x;return s(),n(t,{class:"container"},{default:i(()=>[c(" 页面头部 "),u(t,{class:"page-header"},{default:i(()=>[u(t,{class:"header-content"},{default:i(()=>[u(l,{class:"page-title"},{default:i(()=>[o("编辑资料")]),_:1}),u(l,{class:"page-subtitle"},{default:i(()=>[o("完善个人信息，获得更好的体验")]),_:1})]),_:1})]),_:1}),c(" 头像编辑区域 "),u(t,{class:"avatar-section glass-card"},{default:i(()=>[u(t,{class:"avatar-container",onClick:P},{default:i(()=>[u(C,{class:"avatar-image",src:j.value.avatar||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),u(t,{class:"avatar-overlay"},{default:i(()=>[u(l,{class:"camera-icon"},{default:i(()=>[o("📷")]),_:1}),u(l,{class:"change-text"},{default:i(()=>[o("更换头像")]),_:1})]),_:1}),u(t,{class:"avatar-glow"})]),_:1}),u(l,{class:"avatar-tip"},{default:i(()=>[o("点击更换头像")]),_:1})]),_:1}),c(" 基本信息编辑 "),u(t,{class:"form-section glass-card"},{default:i(()=>[u(t,{class:"section-header"},{default:i(()=>[u(l,{class:"section-title"},{default:i(()=>[o("基本信息")]),_:1})]),_:1}),u(t,{class:"form-group"},{default:i(()=>[u(l,{class:"form-label"},{default:i(()=>[o("昵称")]),_:1}),u(T,{class:"form-input",modelValue:j.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value.nickname=e),placeholder:"请输入昵称",maxlength:"50"},null,8,["modelValue"]),u(t,{class:"input-underline"})]),_:1}),u(t,{class:"form-group"},{default:i(()=>[u(l,{class:"form-label"},{default:i(()=>[o("个人简介")]),_:1}),u(V,{class:"form-textarea",modelValue:j.value.bio,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value.bio=e),placeholder:"介绍一下自己吧...",maxlength:"500","auto-height":""},null,8,["modelValue"]),u(t,{class:"char-count"},{default:i(()=>{var e;return[o(d((null==(e=j.value.bio)?void 0:e.length)||0)+"/500",1)]}),_:1}),u(t,{class:"input-underline"})]),_:1}),u(t,{class:"form-group"},{default:i(()=>[u(l,{class:"form-label"},{default:i(()=>[o("性别")]),_:1}),u(t,{class:"gender-options"},{default:i(()=>[(s(!0),r(_,null,f(I.value,e=>(s(),n(t,{class:w(["gender-option",{active:j.value.gender===e.value}]),key:e.value,onClick:a=>{return l=e.value,void(j.value.gender=l);var l}},{default:i(()=>[u(l,{class:"gender-icon"},{default:i(()=>[o(d(e.icon),1)]),_:2},1024),u(l,{class:"gender-text"},{default:i(()=>[o(d(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),u(t,{class:"form-group"},{default:i(()=>[u(l,{class:"form-label"},{default:i(()=>[o("出生日期")]),_:1}),u(D,{mode:"date",value:j.value.birth_date,onChange:U,class:"date-picker"},{default:i(()=>[u(t,{class:"picker-display"},{default:i(()=>[u(l,{class:"picker-text"},{default:i(()=>[o(d(j.value.birth_date||"请选择出生日期"),1)]),_:1}),u(l,{class:"picker-icon"},{default:i(()=>[o("📅")]),_:1})]),_:1})]),_:1},8,["value"]),u(t,{class:"input-underline"})]),_:1})]),_:1}),c(" 应用设置 "),u(t,{class:"settings-section glass-card"},{default:i(()=>[u(t,{class:"section-header"},{default:i(()=>[u(l,{class:"section-title"},{default:i(()=>[o("应用设置")]),_:1})]),_:1}),u(t,{class:"setting-item"},{default:i(()=>[u(t,{class:"setting-info"},{default:i(()=>[u(l,{class:"setting-icon"},{default:i(()=>[o("🌙")]),_:1}),u(t,{class:"setting-text"},{default:i(()=>[u(l,{class:"setting-name"},{default:i(()=>[o("主题模式")]),_:1}),u(l,{class:"setting-desc"},{default:i(()=>[o("选择您喜欢的主题风格")]),_:1})]),_:1})]),_:1}),u(D,{range:L.value,value:N.value,onChange:z},{default:i(()=>[u(t,{class:"setting-value"},{default:i(()=>[u(l,null,{default:i(()=>[o(d(v(B)),1)]),_:1}),u(l,{class:"arrow-icon"},{default:i(()=>[o(">")]),_:1})]),_:1})]),_:1},8,["range","value"])]),_:1}),u(t,{class:"setting-item"},{default:i(()=>[u(t,{class:"setting-info"},{default:i(()=>[u(l,{class:"setting-icon"},{default:i(()=>[o("🔔")]),_:1}),u(t,{class:"setting-text"},{default:i(()=>[u(l,{class:"setting-name"},{default:i(()=>[o("推送通知")]),_:1}),u(l,{class:"setting-desc"},{default:i(()=>[o("接收情绪提醒和分析报告")]),_:1})]),_:1})]),_:1}),u(E,{checked:j.value.notification_enabled,onChange:A,color:"#667eea"},null,8,["checked"])]),_:1}),j.value.notification_enabled?(s(),n(t,{key:0,class:"setting-item"},{default:i(()=>[u(t,{class:"setting-info"},{default:i(()=>[u(l,{class:"setting-icon"},{default:i(()=>[o("⏰")]),_:1}),u(t,{class:"setting-text"},{default:i(()=>[u(l,{class:"setting-name"},{default:i(()=>[o("提醒时间")]),_:1}),u(l,{class:"setting-desc"},{default:i(()=>[o("每日情绪记录提醒")]),_:1})]),_:1})]),_:1}),u(D,{mode:"time",value:j.value.daily_reminder_time,onChange:M},{default:i(()=>[u(t,{class:"setting-value"},{default:i(()=>[u(l,null,{default:i(()=>[o(d(j.value.daily_reminder_time||"21:00"),1)]),_:1}),u(l,{class:"arrow-icon"},{default:i(()=>[o(">")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):c("v-if",!0),u(t,{class:"setting-item"},{default:i(()=>[u(t,{class:"setting-info"},{default:i(()=>[u(l,{class:"setting-icon"},{default:i(()=>[o("🛡️")]),_:1}),u(t,{class:"setting-text"},{default:i(()=>[u(l,{class:"setting-name"},{default:i(()=>[o("数据分析")]),_:1}),u(l,{class:"setting-desc"},{default:i(()=>[o("允许分析您的情绪数据")]),_:1})]),_:1})]),_:1}),u(E,{checked:j.value.analytics_consent,onChange:O,color:"#667eea"},null,8,["checked"])]),_:1})]),_:1}),c(" 保存按钮 "),u(t,{class:"save-section"},{default:i(()=>[u(G,{class:"save-button",onClick:q,disabled:F.value},{default:i(()=>[u(t,{class:"button-content"},{default:i(()=>[F.value?c("v-if",!0):(s(),n(l,{key:0,class:"save-icon"},{default:i(()=>[o("💾")]),_:1})),F.value?(s(),n(t,{key:1,class:"loading-spinner"})):c("v-if",!0),u(l,{class:"save-text"},{default:i(()=>[o(d(F.value?"保存中...":"保存修改"),1)]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-16615573"]]);export{F as default};
