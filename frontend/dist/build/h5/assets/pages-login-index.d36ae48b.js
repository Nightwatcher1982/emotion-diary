import{o as e,c as n,w as s,i as o,a as t,b as i,d as a,n as l,t as c,e as d,I as u,f as h}from"./index-6afd3b48.js";import{a as g,s as r,b as p}from"./api.ae518a48.js";import{_ as m}from"./_plugin-vue_export-helper.1b428a4d.js";const f=m({data:()=>({phoneForm:{phone:"",code:"",nickname:""},isPhoneLogging:!1,isWechatLogging:!1,isSendingSMS:!1,smsCountdown:0,isDevelopment:!1,debugInfo:""}),computed:{canSendSMS(){return 11===this.phoneForm.phone.length&&/^1[3-9]\d{9}$/.test(this.phoneForm.phone)},canPhoneLogin(){return this.canSendSMS&&6===this.phoneForm.code.length},getSMSButtonText(){return this.isSendingSMS?"å‘é€ä¸­...":this.smsCountdown>0?`${this.smsCountdown}s`:"è·å–éªŒè¯ç "}},methods:{onPhoneInput(e){this.phoneForm.phone=e.detail.value.replace(/\D/g,"")},async sendSMS(){if(this.canSendSMS&&!this.isSendingSMS){this.isSendingSMS=!0,this.debugInfo="æ­£åœ¨å‘é€éªŒè¯ç ...";try{const e=await g.sendSMS({phone:this.phoneForm.phone,purpose:"login"});uni.showToast({title:"éªŒè¯ç å‘é€æˆåŠŸ",icon:"success"}),e.code&&this.isDevelopment?(this.debugInfo=`éªŒè¯ç : ${e.code}`,this.phoneForm.code=e.code):this.debugInfo="è¯·æŸ¥æ”¶çŸ­ä¿¡éªŒè¯ç ",this.startCountdown()}catch(e){console.error("å‘é€éªŒè¯ç å¤±è´¥:",e),this.debugInfo=`å‘é€å¤±è´¥: ${e.message}`,uni.showToast({title:e.message||"éªŒè¯ç å‘é€å¤±è´¥",icon:"none"})}finally{this.isSendingSMS=!1}}},startCountdown(){this.smsCountdown=60;const e=setInterval(()=>{this.smsCountdown--,this.smsCountdown<=0&&clearInterval(e)},1e3)},async handlePhoneLogin(){if(this.canPhoneLogin&&!this.isPhoneLogging){this.isPhoneLogging=!0,this.debugInfo="æ­£åœ¨éªŒè¯ç™»å½•...";try{const e=await g.phoneLogin({phone:this.phoneForm.phone,code:this.phoneForm.code,nickname:this.phoneForm.nickname});r(e.token),p(e.user),this.debugInfo="ç™»å½•æˆåŠŸ! "+(e.is_new_user?"(æ–°ç”¨æˆ·)":"(è€ç”¨æˆ·)"),uni.showToast({title:e.is_new_user?"æ³¨å†ŒæˆåŠŸ":"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout(()=>{uni.switchTab({url:"/pages/index/index"})},1500)}catch(e){console.error("æ‰‹æœºç™»å½•å¤±è´¥:",e),this.debugInfo=`ç™»å½•å¤±è´¥: ${e.message}`,uni.showToast({title:e.message||"ç™»å½•å¤±è´¥",icon:"none"})}finally{this.isPhoneLogging=!1}}},async handleWechatLogin(){if(!this.isWechatLogging){this.isWechatLogging=!0,this.debugInfo="æ­£åœ¨å¾®ä¿¡ç™»å½•...";try{if(this.isDevelopment){const e=`mock_code_${Date.now()}`,n=await g.wechatLogin({code:e,nickname:"å¾®ä¿¡ç”¨æˆ·",gender:"unknown"});r(n.token),p(n.user),this.debugInfo="å¾®ä¿¡ç™»å½•æˆåŠŸ! "+(n.is_new_user?"(æ–°ç”¨æˆ·)":"(è€ç”¨æˆ·)"),uni.showToast({title:n.is_new_user?"æ³¨å†ŒæˆåŠŸ":"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout(()=>{uni.switchTab({url:"/pages/index/index"})},1500)}else uni.showToast({title:"å¾®ä¿¡ç™»å½•åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}catch(e){console.error("å¾®ä¿¡ç™»å½•å¤±è´¥:",e),this.debugInfo=`å¾®ä¿¡ç™»å½•å¤±è´¥: ${e.message}`,uni.showToast({title:e.message||"å¾®ä¿¡ç™»å½•å¤±è´¥",icon:"none"})}finally{this.isWechatLogging=!1}}},fillTestPhone(){this.phoneForm.phone="13800138000",this.phoneForm.nickname="æµ‹è¯•ç”¨æˆ·"},mockWechatLogin(){this.handleWechatLogin()},showPrivacyPolicy(){uni.showModal({title:"ç”¨æˆ·åè®®ä¸éšç§æ”¿ç­–",content:"æˆ‘ä»¬æ‰¿è¯ºä¿æŠ¤æ‚¨çš„éšç§ï¼Œæ‰€æœ‰æƒ…ç»ªæ•°æ®ä»…ç”¨äºä¸ªäººåˆ†æï¼Œä¸ä¼šä¸ç¬¬ä¸‰æ–¹åˆ†äº«ã€‚",showCancel:!1})}}},[["render",function(g,r,p,m,f,_){const S=d,b=o,w=u,k=h;return e(),n(b,{class:"login-container"},{default:s(()=>[t(b,{class:"login-card glass-card"},{default:s(()=>[i(" LogoåŒºåŸŸ "),t(b,{class:"logo-section"},{default:s(()=>[t(S,{class:"logo-text"},{default:s(()=>[a("AIæƒ…ç»ªæ—¥è®°")]),_:1}),t(S,{class:"subtitle"},{default:s(()=>[a("è®°å½•æƒ…ç»ªï¼Œç†è§£è‡ªå·±")]),_:1})]),_:1}),i(" ç™»å½•æ–¹å¼é€‰æ‹© "),t(b,{class:"login-methods"},{default:s(()=>[i(" æ‰‹æœºéªŒè¯ç ç™»å½• "),t(b,{class:"phone-login-section"},{default:s(()=>[t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("ğŸ“±")]),_:1}),t(w,{type:"number",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",modelValue:f.phoneForm.phone,"onUpdate:modelValue":r[0]||(r[0]=e=>f.phoneForm.phone=e),class:"input-field",maxlength:"11",onInput:_.onPhoneInput},null,8,["modelValue","onInput"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.phone}])},null,8,["class"])]),_:1}),t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("ğŸ”¢")]),_:1}),t(w,{type:"number",placeholder:"è¯·è¾“å…¥éªŒè¯ç ",modelValue:f.phoneForm.code,"onUpdate:modelValue":r[1]||(r[1]=e=>f.phoneForm.code=e),class:"input-field",maxlength:"6"},null,8,["modelValue"]),t(k,{class:l(["sms-btn",{disabled:!_.canSendSMS||f.smsCountdown>0,loading:f.isSendingSMS}]),onClick:_.sendSMS,disabled:!_.canSendSMS||f.smsCountdown>0||f.isSendingSMS},{default:s(()=>[a(c(_.getSMSButtonText),1)]),_:1},8,["class","onClick","disabled"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.code}])},null,8,["class"])]),_:1}),i(" æ˜µç§°è¾“å…¥ï¼ˆå¯é€‰ï¼‰ "),t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("âœ¨")]),_:1}),t(w,{type:"text",placeholder:"è®¾ç½®æ˜µç§°ï¼ˆå¯é€‰ï¼‰",modelValue:f.phoneForm.nickname,"onUpdate:modelValue":r[2]||(r[2]=e=>f.phoneForm.nickname=e),class:"input-field",maxlength:"20"},null,8,["modelValue"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.nickname}])},null,8,["class"])]),_:1}),t(k,{class:l(["login-btn phone-login-btn",{loading:f.isPhoneLogging}]),onClick:_.handlePhoneLogin,disabled:!_.canPhoneLogin||f.isPhoneLogging},{default:s(()=>[t(S,{class:"btn-text"},{default:s(()=>[a(c(f.isPhoneLogging?"ç™»å½•ä¸­...":"æ‰‹æœºå·ç™»å½•"),1)]),_:1})]),_:1},8,["class","onClick","disabled"])]),_:1}),i(" åˆ†éš”çº¿ "),t(b,{class:"divider"},{default:s(()=>[t(b,{class:"divider-line"}),t(S,{class:"divider-text"},{default:s(()=>[a("æˆ–")]),_:1}),t(b,{class:"divider-line"})]),_:1}),i(" å¾®ä¿¡ç™»å½• "),t(b,{class:"wechat-login-section"},{default:s(()=>[t(k,{class:l(["login-btn wechat-login-btn",{loading:f.isWechatLogging}]),onClick:_.handleWechatLogin,disabled:f.isWechatLogging},{default:s(()=>[t(S,{class:"wechat-icon"},{default:s(()=>[a("ğŸ’¬")]),_:1}),t(S,{class:"btn-text"},{default:s(()=>[a(c(f.isWechatLogging?"ç™»å½•ä¸­...":"å¾®ä¿¡ç™»å½•"),1)]),_:1})]),_:1},8,["class","onClick","disabled"])]),_:1}),i(" å¼€å‘ç¯å¢ƒæµ‹è¯•åŒºåŸŸ "),f.isDevelopment?(e(),n(b,{key:0,class:"debug-section"},{default:s(()=>[t(b,{class:"debug-title"},{default:s(()=>[a("å¼€å‘æµ‹è¯•")]),_:1}),t(b,{class:"debug-actions"},{default:s(()=>[t(k,{class:"debug-btn",onClick:_.fillTestPhone},{default:s(()=>[a("æµ‹è¯•æ‰‹æœºå·")]),_:1},8,["onClick"]),t(k,{class:"debug-btn",onClick:_.mockWechatLogin},{default:s(()=>[a("æ¨¡æ‹Ÿå¾®ä¿¡ç™»å½•")]),_:1},8,["onClick"])]),_:1}),f.debugInfo?(e(),n(b,{key:0,class:"debug-info"},{default:s(()=>[t(S,{class:"debug-text"},{default:s(()=>[a(c(f.debugInfo),1)]),_:1})]),_:1})):i("v-if",!0)]),_:1})):i("v-if",!0)]),_:1})]),_:1}),i(" ç”¨æˆ·åè®® "),t(b,{class:"agreement-section"},{default:s(()=>[t(S,{class:"agreement-text"},{default:s(()=>[a(" ç™»å½•å³è¡¨ç¤ºåŒæ„ "),t(S,{class:"agreement-link",onClick:_.showPrivacyPolicy},{default:s(()=>[a("ã€Šç”¨æˆ·åè®®ã€‹")]),_:1},8,["onClick"]),a(" å’Œ "),t(S,{class:"agreement-link",onClick:_.showPrivacyPolicy},{default:s(()=>[a("ã€Šéšç§æ”¿ç­–ã€‹")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-71a31993"]]);export{f as default};
