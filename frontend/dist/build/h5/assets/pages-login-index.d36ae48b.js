import{o as e,c as n,w as s,i as o,a as t,b as i,d as a,n as l,t as c,e as d,I as u,f as h}from"./index-6afd3b48.js";import{a as g,s as r,b as p}from"./api.ae518a48.js";import{_ as m}from"./_plugin-vue_export-helper.1b428a4d.js";const f=m({data:()=>({phoneForm:{phone:"",code:"",nickname:""},isPhoneLogging:!1,isWechatLogging:!1,isSendingSMS:!1,smsCountdown:0,isDevelopment:!1,debugInfo:""}),computed:{canSendSMS(){return 11===this.phoneForm.phone.length&&/^1[3-9]\d{9}$/.test(this.phoneForm.phone)},canPhoneLogin(){return this.canSendSMS&&6===this.phoneForm.code.length},getSMSButtonText(){return this.isSendingSMS?"发送中...":this.smsCountdown>0?`${this.smsCountdown}s`:"获取验证码"}},methods:{onPhoneInput(e){this.phoneForm.phone=e.detail.value.replace(/\D/g,"")},async sendSMS(){if(this.canSendSMS&&!this.isSendingSMS){this.isSendingSMS=!0,this.debugInfo="正在发送验证码...";try{const e=await g.sendSMS({phone:this.phoneForm.phone,purpose:"login"});uni.showToast({title:"验证码发送成功",icon:"success"}),e.code&&this.isDevelopment?(this.debugInfo=`验证码: ${e.code}`,this.phoneForm.code=e.code):this.debugInfo="请查收短信验证码",this.startCountdown()}catch(e){console.error("发送验证码失败:",e),this.debugInfo=`发送失败: ${e.message}`,uni.showToast({title:e.message||"验证码发送失败",icon:"none"})}finally{this.isSendingSMS=!1}}},startCountdown(){this.smsCountdown=60;const e=setInterval(()=>{this.smsCountdown--,this.smsCountdown<=0&&clearInterval(e)},1e3)},async handlePhoneLogin(){if(this.canPhoneLogin&&!this.isPhoneLogging){this.isPhoneLogging=!0,this.debugInfo="正在验证登录...";try{const e=await g.phoneLogin({phone:this.phoneForm.phone,code:this.phoneForm.code,nickname:this.phoneForm.nickname});r(e.token),p(e.user),this.debugInfo="登录成功! "+(e.is_new_user?"(新用户)":"(老用户)"),uni.showToast({title:e.is_new_user?"注册成功":"登录成功",icon:"success"}),setTimeout(()=>{uni.switchTab({url:"/pages/index/index"})},1500)}catch(e){console.error("手机登录失败:",e),this.debugInfo=`登录失败: ${e.message}`,uni.showToast({title:e.message||"登录失败",icon:"none"})}finally{this.isPhoneLogging=!1}}},async handleWechatLogin(){if(!this.isWechatLogging){this.isWechatLogging=!0,this.debugInfo="正在微信登录...";try{if(this.isDevelopment){const e=`mock_code_${Date.now()}`,n=await g.wechatLogin({code:e,nickname:"微信用户",gender:"unknown"});r(n.token),p(n.user),this.debugInfo="微信登录成功! "+(n.is_new_user?"(新用户)":"(老用户)"),uni.showToast({title:n.is_new_user?"注册成功":"登录成功",icon:"success"}),setTimeout(()=>{uni.switchTab({url:"/pages/index/index"})},1500)}else uni.showToast({title:"微信登录功能开发中",icon:"none"})}catch(e){console.error("微信登录失败:",e),this.debugInfo=`微信登录失败: ${e.message}`,uni.showToast({title:e.message||"微信登录失败",icon:"none"})}finally{this.isWechatLogging=!1}}},fillTestPhone(){this.phoneForm.phone="13800138000",this.phoneForm.nickname="测试用户"},mockWechatLogin(){this.handleWechatLogin()},showPrivacyPolicy(){uni.showModal({title:"用户协议与隐私政策",content:"我们承诺保护您的隐私，所有情绪数据仅用于个人分析，不会与第三方分享。",showCancel:!1})}}},[["render",function(g,r,p,m,f,_){const S=d,b=o,w=u,k=h;return e(),n(b,{class:"login-container"},{default:s(()=>[t(b,{class:"login-card glass-card"},{default:s(()=>[i(" Logo区域 "),t(b,{class:"logo-section"},{default:s(()=>[t(S,{class:"logo-text"},{default:s(()=>[a("AI情绪日记")]),_:1}),t(S,{class:"subtitle"},{default:s(()=>[a("记录情绪，理解自己")]),_:1})]),_:1}),i(" 登录方式选择 "),t(b,{class:"login-methods"},{default:s(()=>[i(" 手机验证码登录 "),t(b,{class:"phone-login-section"},{default:s(()=>[t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("📱")]),_:1}),t(w,{type:"number",placeholder:"请输入手机号",modelValue:f.phoneForm.phone,"onUpdate:modelValue":r[0]||(r[0]=e=>f.phoneForm.phone=e),class:"input-field",maxlength:"11",onInput:_.onPhoneInput},null,8,["modelValue","onInput"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.phone}])},null,8,["class"])]),_:1}),t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("🔢")]),_:1}),t(w,{type:"number",placeholder:"请输入验证码",modelValue:f.phoneForm.code,"onUpdate:modelValue":r[1]||(r[1]=e=>f.phoneForm.code=e),class:"input-field",maxlength:"6"},null,8,["modelValue"]),t(k,{class:l(["sms-btn",{disabled:!_.canSendSMS||f.smsCountdown>0,loading:f.isSendingSMS}]),onClick:_.sendSMS,disabled:!_.canSendSMS||f.smsCountdown>0||f.isSendingSMS},{default:s(()=>[a(c(_.getSMSButtonText),1)]),_:1},8,["class","onClick","disabled"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.code}])},null,8,["class"])]),_:1}),i(" 昵称输入（可选） "),t(b,{class:"input-group"},{default:s(()=>[t(b,{class:"input-wrapper"},{default:s(()=>[t(S,{class:"input-icon"},{default:s(()=>[a("✨")]),_:1}),t(w,{type:"text",placeholder:"设置昵称（可选）",modelValue:f.phoneForm.nickname,"onUpdate:modelValue":r[2]||(r[2]=e=>f.phoneForm.nickname=e),class:"input-field",maxlength:"20"},null,8,["modelValue"])]),_:1}),t(b,{class:l(["input-underline",{active:f.phoneForm.nickname}])},null,8,["class"])]),_:1}),t(k,{class:l(["login-btn phone-login-btn",{loading:f.isPhoneLogging}]),onClick:_.handlePhoneLogin,disabled:!_.canPhoneLogin||f.isPhoneLogging},{default:s(()=>[t(S,{class:"btn-text"},{default:s(()=>[a(c(f.isPhoneLogging?"登录中...":"手机号登录"),1)]),_:1})]),_:1},8,["class","onClick","disabled"])]),_:1}),i(" 分隔线 "),t(b,{class:"divider"},{default:s(()=>[t(b,{class:"divider-line"}),t(S,{class:"divider-text"},{default:s(()=>[a("或")]),_:1}),t(b,{class:"divider-line"})]),_:1}),i(" 微信登录 "),t(b,{class:"wechat-login-section"},{default:s(()=>[t(k,{class:l(["login-btn wechat-login-btn",{loading:f.isWechatLogging}]),onClick:_.handleWechatLogin,disabled:f.isWechatLogging},{default:s(()=>[t(S,{class:"wechat-icon"},{default:s(()=>[a("💬")]),_:1}),t(S,{class:"btn-text"},{default:s(()=>[a(c(f.isWechatLogging?"登录中...":"微信登录"),1)]),_:1})]),_:1},8,["class","onClick","disabled"])]),_:1}),i(" 开发环境测试区域 "),f.isDevelopment?(e(),n(b,{key:0,class:"debug-section"},{default:s(()=>[t(b,{class:"debug-title"},{default:s(()=>[a("开发测试")]),_:1}),t(b,{class:"debug-actions"},{default:s(()=>[t(k,{class:"debug-btn",onClick:_.fillTestPhone},{default:s(()=>[a("测试手机号")]),_:1},8,["onClick"]),t(k,{class:"debug-btn",onClick:_.mockWechatLogin},{default:s(()=>[a("模拟微信登录")]),_:1},8,["onClick"])]),_:1}),f.debugInfo?(e(),n(b,{key:0,class:"debug-info"},{default:s(()=>[t(S,{class:"debug-text"},{default:s(()=>[a(c(f.debugInfo),1)]),_:1})]),_:1})):i("v-if",!0)]),_:1})):i("v-if",!0)]),_:1})]),_:1}),i(" 用户协议 "),t(b,{class:"agreement-section"},{default:s(()=>[t(S,{class:"agreement-text"},{default:s(()=>[a(" 登录即表示同意 "),t(S,{class:"agreement-link",onClick:_.showPrivacyPolicy},{default:s(()=>[a("《用户协议》")]),_:1},8,["onClick"]),a(" 和 "),t(S,{class:"agreement-link",onClick:_.showPrivacyPolicy},{default:s(()=>[a("《隐私政策》")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-71a31993"]]);export{f as default};
